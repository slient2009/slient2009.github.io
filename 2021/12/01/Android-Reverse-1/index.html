<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/pig_128x128.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/pig_32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/pig_16x16.ico">
  <link rel="mask-icon" href="/images/pig_128x128.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rotoro Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"slient2009.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记录最近做的一些Android逆向题目。">
<meta property="og:type" content="article">
<meta property="og:title" content="几个Android逆向">
<meta property="og:url" content="http://slient2009.github.io/2021/12/01/Android-Reverse-1/index.html">
<meta property="og:site_name" content="Slient2009">
<meta property="og:description" content="记录最近做的一些Android逆向题目。">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820113557084.png">
<meta property="og:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820143926398.png">
<meta property="og:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820114137957.png">
<meta property="og:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820144400989.png">
<meta property="og:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820144857352.png">
<meta property="og:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820145309550.png">
<meta property="og:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820150709400.png">
<meta property="og:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820150729060.png">
<meta property="og:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/Snipaste_2021-00-52-201.png">
<meta property="og:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20211026132532729.png">
<meta property="article:published_time" content="2021-12-01T05:00:00.000Z">
<meta property="article:modified_time" content="2022-01-08T09:28:08.000Z">
<meta property="article:author" content="slient2009">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820113557084.png">

<link rel="canonical" href="http://slient2009.github.io/2021/12/01/Android-Reverse-1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'ja'
  };
</script>

  <title>几个Android逆向 | Slient2009</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Slient2009" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="ナビゲーションバーの切り替え">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Slient2009</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">All I need is Twin Island Milk</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>ホーム</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>プロフィール</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>タグ<span class="badge">7</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>アーカイブ<span class="badge">13</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="ja">
    <link itemprop="mainEntityOfPage" href="http://slient2009.github.io/2021/12/01/Android-Reverse-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/round_tiger.png">
      <meta itemprop="name" content="slient2009">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Slient2009">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          几个Android逆向
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">投稿日</span>

              <time title="作成日：2021-12-01 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-01T00:00:00-05:00">2021-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">編集日</span>
                <time title="修正日：2022-01-08 04:28:08" itemprop="dateModified" datetime="2022-01-08T04:28:08-05:00">2022-01-08</time>
              </span>

          
            <span class="post-meta-item" title="閲覧数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">閲覧数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>记录最近做的一些Android逆向题目。</p>
<span id="more"></span>

<h1 id="Accelerate-Time"><a href="#Accelerate-Time" class="headerlink" title="Accelerate-Time"></a>Accelerate-Time</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/slient2009/PicGo/blob/main/files/HUAWEI-CTF-%E9%A2%98%E7%9B%AE%E9%99%84%E4%BB%B6.zip">华为内部CTF</a></p>
</blockquote>
<p>进去提示只能在固定的时间才能登录，于是先hook this.hour=4。</p>
<p><img src="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820113557084.png" alt="image-20210820113557084"></p>
<p>跟着走发现需要验证username和password。<br>逻辑比较长且复杂，跟着Password View的监听函数一步步跟找到校验username和password的逻辑。</p>
<p><img src="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820143926398.png" alt="image-20210820143926398"></p>
<p>关注password的监听事件，在这里可以逆向得到username=Android和password=Greatly。</p>
<p><img src="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820114137957.png" alt="image-20210820114137957"></p>
<p>username和password得到验证之后，关注login按钮的监听事件，但是最终还是进入到上述的校验逻辑中。<br>接着貌似验证过程就结束了。虽然在onCreate()之后就能发现另外一段校验函数，但是这个函数是如何调用的呢？</p>
<p><img src="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820144400989.png" alt="image-20210820144400989"></p>
<p>关注一开始设置的observer，根据LoginActivity.onCreate.2的构造函数，观察的对象就是传进去的当前的LoginActivity。<br>进一步的，如果当前的LoginActivity发生了变化，会调用到updateUiWithUser()进行二次验证。</p>
<p><img src="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820144857352.png" alt="image-20210820144857352"></p>
<p>在login按钮的点击事件中，会进入下面的函数。<br>Result oLoggedInUser是用户名和密码校验的返回结果，这里检查是否返回了success，如果是，则把this._LoginResult（MutableLiveData类）设置success的子类。这样的修改会被观察者模式发觉，因此调用回调函数onChanged并进一步调用showLoginFailed()或者updateUiWithUser()。</p>
<p><img src="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820145309550.png" alt="image-20210820145309550"></p>
<p>仔细观察updateUiWithUser()函数，先构造字符串<code>hour+minute+second</code>计算hash值timeMD5，然后构造字符串<code>flag&#123;+timeMD5+&#125;+username+password</code>。<br>但是需要注意的是，username和password是直接使用的其对应的EditText对象，所以拼接的不是<code>Android+Greatly</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">updateUiWithUser</span><span class="params">(LoggedInUserView arg3)</span> </span>&#123;</span><br><span class="line">        Intrinsics.checkExpressionValueIsNotNull(<span class="keyword">this</span>.getString(<span class="number">0x7F0D0041</span>), <span class="string">&quot;getString(R.string.welcome)&quot;</span>);  <span class="comment">// string:welcome &quot;Welcome !&quot;</span></span><br><span class="line">        arg3.getDisplayName();</span><br><span class="line">        <span class="keyword">if</span>(Intrinsics.areEqual(LoginActivityKt.encodeMD5(<span class="string">&quot;flag&#123;&quot;</span> + LoginActivityKt.encodeMD5(String.valueOf(<span class="keyword">this</span>.hour) + String.valueOf(<span class="keyword">this</span>.minute) + String.valueOf(<span class="keyword">this</span>.second)) + <span class="string">&quot;&#125;&quot;</span> + ((EditText)<span class="keyword">this</span>._$_findCachedViewById(id.username)) + ((EditText)<span class="keyword">this</span>._$_findCachedViewById(id.password))), <span class="keyword">this</span>.getString(<span class="number">0x7F0D002E</span>))) &#123;  <span class="comment">// string:code &quot;1a9852e856816224&quot;</span></span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>.getApplicationContext(), <span class="string">&quot;Congulations, You got the secert code&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>.getApplicationContext(), <span class="string">&quot;Yeah, you are logged in but the code is still hidden under the mist&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>虽然非常奇怪，但是不管是smali代码还是hook LoginActivitykt.encodeMD5()的输入参数，都证明确实直接拼接了EditText对象。</p>
<img src="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820150709400.png" alt="image-20210820150709400" style="zoom: 80%;" />

<img src="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20210820150729060.png" alt="image-20210820150729060" style="zoom: 50%;" />

<p>解密的思路非常简单，直接爆破时间，计算24*60*60次。<br>如果按照<code>flag&#123;MD5(hour+minute+second)&#125;AndroidGreatly</code>来计算，可以得到时间为4:35:23，且hash值满足要求。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">aim = <span class="string">&quot;1a9852e856816224&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">25</span>):</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">61</span>):</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">61</span>):</span><br><span class="line">            timebytes = (<span class="built_in">str</span>(h) + <span class="built_in">str</span>(m) +<span class="built_in">str</span>(s)).encode()</span><br><span class="line">            timehash = hashlib.md5(timebytes).hexdigest()</span><br><span class="line">            thehash  = hashlib.md5( (<span class="string">&quot;flag&#123;&quot;</span> + timehash[<span class="number">8</span>:<span class="number">24</span>] + <span class="string">&quot;&#125;AndroidGreatly&quot;</span>).encode() ).hexdigest()</span><br><span class="line">            <span class="keyword">if</span>(thehash[<span class="number">8</span>:<span class="number">24</span>] == aim):</span><br><span class="line">                <span class="built_in">print</span>(h,m,s)</span><br><span class="line">                <span class="built_in">print</span>(timehash)</span><br><span class="line">                <span class="built_in">print</span>(thehash)</span><br></pre></td></tr></table></figure>

<p>如果严格按照代码来，则找不出满足要求的时间。<br>frida爆破代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//覆盖updateUiWithUser()，改为爆破函数，主动调用LoginActiivtyKt.encodeMD5()。</span></span><br><span class="line"><span class="comment">//hook Intrinsics.areEqual(),拦截hash=&quot;1a9852e856816224&quot;的情况</span></span><br><span class="line"><span class="comment">//hook LoginAcitivityKt.encodeMD5()，拦截某次hash值为&quot;1a9852e856816224&quot;的情况，同时打印明文字符串，验证确实直接拼接了EditText对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;long live frida&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> LoginActivityClass = Java.use(<span class="string">&quot;com.flag.reverse.c.ui.login.LoginActivity&quot;</span>);</span><br><span class="line">        LoginActivityClass.$init.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">//hook构造函数，预置时间为4:35:23也过不了</span></span><br><span class="line">            <span class="built_in">this</span>.$init();</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;into LoginActivity() args=&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.hour.value, <span class="built_in">this</span>.minute.value, <span class="built_in">this</span>.second.value);</span><br><span class="line">			<span class="built_in">this</span>.hour.value = <span class="number">4</span>;</span><br><span class="line">			<span class="built_in">this</span>.minute.value = <span class="number">35</span>;</span><br><span class="line">			<span class="built_in">this</span>.second.value = <span class="number">23</span>;</span><br><span class="line">			</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.hour.value, <span class="built_in">this</span>.minute.value, <span class="built_in">this</span>.second.value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> LoginActivityKt = Java.use(<span class="string">&quot;com.flag.reverse.c.ui.login.LoginActivityKt&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> intrics = Java.use(<span class="string">&quot;kotlin.jvm.internal.Intrinsics&quot;</span>);</span><br><span class="line">		intrics.areEqual.overload(<span class="string">&quot;java.lang.Object&quot;</span>, <span class="string">&quot;java.lang.Object&quot;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">s1, s2</span>)</span>&#123;</span><br><span class="line">			<span class="comment">// console.log(s1,s2);</span></span><br><span class="line">			<span class="keyword">if</span>(s1 == s2)&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">&quot;into areEqual() args=&quot;</span>, s1, s2);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>.areEqual(s1, s2);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> stop = <span class="literal">false</span>;</span><br><span class="line">		LoginActivityKt.encodeMD5.overload(<span class="string">&quot;java.lang.String&quot;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">plain</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> hashstr = <span class="built_in">this</span>.encodeMD5(plain);</span><br><span class="line">			<span class="keyword">if</span>(hashstr == <span class="string">&quot;1a9852e856816224&quot;</span>)&#123; </span><br><span class="line">				stop = <span class="literal">true</span>;</span><br><span class="line">				<span class="built_in">console</span>.log(plain);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> hashstr;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		LoginActivityClass.updateUiWithUser.overload(<span class="string">&quot;com.flag.reverse.c.ui.login.LoggedInUserView&quot;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> last_v;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> h=<span class="number">0</span>;h&lt;=<span class="number">24</span>;h++)&#123;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">var</span> m=<span class="number">0</span>;m&lt;=<span class="number">60</span>;m++)&#123;</span><br><span class="line">					<span class="built_in">console</span>.log(h,m);</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">var</span> s=<span class="number">0</span>;s&lt;=<span class="number">60</span>;s++)&#123;</span><br><span class="line">						<span class="keyword">if</span>(!stop)&#123;</span><br><span class="line">							<span class="built_in">this</span>.hour.value = h;</span><br><span class="line">							<span class="built_in">this</span>.minute.value = m;</span><br><span class="line">							<span class="built_in">this</span>.second.value = s;</span><br><span class="line">							last_v = <span class="built_in">this</span>.updateUiWithUser(v);</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">else</span>&#123;</span><br><span class="line">							<span class="built_in">console</span>.log(<span class="built_in">this</span>.hour.value, <span class="built_in">this</span>.minute.value, <span class="built_in">this</span>.second.value);</span><br><span class="line">							<span class="keyword">return</span> last_v;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure>



<h1 id="Time-Machine"><a href="#Time-Machine" class="headerlink" title="Time-Machine"></a>Time-Machine</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/slient2009/PicGo/blob/main/files/HUAWEI-CTF-%E9%A2%98%E7%9B%AE%E9%99%84%E4%BB%B6.zip">华为内部CTF</a></p>
</blockquote>
<p>这道题做得比较久，中途基本想放弃了，不过还是坚持做下来了，值得给自己点赞。（雾</p>
<p>首先看一下Java层，还好没有太多逻辑需要厘清。<br>要求先后点击两个按钮并获取点击时间，要求第一个时间戳大于第二个时间戳，显然这是不能实现的。（对应题目的名字Time Machine）<br>可以通过Frida Hook时间类，或者直接修改smali代码，把大于改成小于即可。为了后续IDA动态调试方便，我选择了后者。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-lib&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// androidx.appcompat.app.AppCompatActivity</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle arg7)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(arg7);</span><br><span class="line">        <span class="keyword">this</span>.setContentView(<span class="number">0x7F0A001C</span>);  <span class="comment">// layout:activity_main</span></span><br><span class="line">        Button startButton = (Button)<span class="keyword">this</span>.findViewById(<span class="number">0x7F070042</span>);  <span class="comment">// id:button</span></span><br><span class="line">        Button stopButton = (Button)<span class="keyword">this</span>.findViewById(<span class="number">0x7F070043</span>);  <span class="comment">// id:button2</span></span><br><span class="line">        <span class="keyword">long</span>[] startTime = <span class="keyword">new</span> <span class="keyword">long</span>[]&#123;<span class="number">0L</span>&#125;;</span><br><span class="line">        <span class="keyword">long</span>[] endTime = <span class="keyword">new</span> <span class="keyword">long</span>[]&#123;<span class="number">0L</span>&#125;;</span><br><span class="line">        startButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span>  <span class="comment">// android.view.View$OnClickListener</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View arg4)</span> </span>&#123;</span><br><span class="line">                startTime[<span class="number">0</span>] = System.currentTimeMillis();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        stopButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span>  <span class="comment">// android.view.View$OnClickListener</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View arg7)</span> </span>&#123;</span><br><span class="line">                endTime[<span class="number">0</span>] = System.currentTimeMillis();</span><br><span class="line">                <span class="keyword">long</span>[] v7 = startTime;</span><br><span class="line">                <span class="keyword">if</span>(v7[<span class="number">0</span>] == <span class="number">0L</span>) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;game not start &quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">long</span> startTime2 = v7[<span class="number">0</span>];</span><br><span class="line">                String endTime2 = endTime[<span class="number">0</span>] + <span class="string">&quot; &quot;</span>;</span><br><span class="line">                <span class="keyword">if</span>(startTime2 - endTime[<span class="number">0</span>] &gt; <span class="number">1L</span>) &#123; <span class="comment">//不修改或者调试过不了的条件</span></span><br><span class="line">                    Bundle timeString = <span class="keyword">new</span> Bundle();</span><br><span class="line">                    timeString.putString(<span class="string">&quot;starttime&quot;</span>, startTime2 + <span class="string">&quot; &quot;</span>);</span><br><span class="line">                    timeString.putString(<span class="string">&quot;endtime&quot;</span>, endTime2);</span><br><span class="line">                    Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">                    intent.setClass(MainActivity.<span class="keyword">this</span>, Main2Activity.class);</span><br><span class="line">                    intent.putExtras(timeString);</span><br><span class="line">                    MainActivity.<span class="keyword">this</span>.startActivity(intent);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就输入flag并进行检查。<br>要求flag长度为42，格式为<code>flag&#123;xxxxx&#125;</code>，flag前三位是<code>e25</code>，第三到第八位的md5值为<code>1E862D87DB3293B81C7D2934577A22FA</code>，用<code>somd5</code>解出来是<code>be952</code>。<br>然后把flag剩余的部分交给check函数传到native层去检查。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle bundle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle);</span><br><span class="line">        <span class="keyword">this</span>.setContentView(<span class="number">0x7F0A001D</span>);  <span class="comment">// layout:activity_main2</span></span><br><span class="line">        Bundle v3 = <span class="keyword">this</span>.getIntent().getExtras();</span><br><span class="line">        v0.toString();</span><br><span class="line">        v3.getString(<span class="string">&quot;endtime&quot;</span>);</span><br><span class="line">        EditText mEditText = (EditText)<span class="keyword">this</span>.findViewById(<span class="number">0x7F070056</span>);  <span class="comment">// id:editText</span></span><br><span class="line">        ((Button)<span class="keyword">this</span>.findViewById(<span class="number">0x7F070044</span>)).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  <span class="comment">// id:button3</span></span><br><span class="line">            <span class="meta">@Override</span>  <span class="comment">// android.view.View$OnClickListener</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View arg6)</span> </span>&#123;</span><br><span class="line">                String inputFlag = mEditText.getText().toString();</span><br><span class="line">                <span class="keyword">if</span>(inputFlag.length() != <span class="number">42</span>) &#123;</span><br><span class="line">                    Toast.makeText(Main2Activity.<span class="keyword">this</span>, <span class="string">&quot;Wrong！！！&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>((inputFlag.substring(<span class="number">0</span>, <span class="number">5</span>).equals(<span class="string">&quot;flag&#123;&quot;</span>)) &amp;&amp; (inputFlag.substring(<span class="number">41</span>).equals(<span class="string">&quot;&#125;&quot;</span>))) &#123;</span><br><span class="line">                    String flagStr = inputFlag.substring(<span class="number">5</span>, <span class="number">41</span>);</span><br><span class="line">                    <span class="keyword">if</span>((flagStr.substring(<span class="number">0</span>, <span class="number">3</span>).equals(<span class="string">&quot;e25&quot;</span>)) &amp;&amp; (Main2Activity.<span class="keyword">this</span>.md5(flagStr.substring(<span class="number">3</span>, <span class="number">8</span>)).equals(<span class="string">&quot;1E862D87DB3293B81C7D2934577A22FA&quot;</span>))) &#123;</span><br><span class="line">                        Toast.makeText(Main2Activity.<span class="keyword">this</span>, Main2Activity.<span class="keyword">this</span>.Check(flagStr.substring(<span class="number">8</span>)), <span class="number">0</span>).show();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(Main2Activity.<span class="keyword">this</span>, <span class="string">&quot;wrong~~&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>IDA分析so文件，本着一直以来的习惯先检查<code>init_array</code>和<code>JNI_onload</code>。<br><code>init_array</code>有三个函数，其中一个使用了<code>pthread_create_key</code>，看起来好像没有反调试代码，但是真要IDA动态调试会退出，所以把它们patch过掉。</p>
<p>事实上目前笔者对于如何优雅地patch init_array还是不大了解。<br>之前尝试过直接修改init_array中元素值为0x0000，但是后面打包安装会出错；也尝试过在函数内部插入POP指令直接返回，但是没有处理好堆栈还是出问题了；这里是把init_array中的值修改为一个无关函数的起始地址来patch掉检测代码的。</p>
<p>过掉反检测代码，检查JNI_onload中的动态注册操作，比较简单，就是把sub_8ED24CF8()函数注册为check()函数。<br>在sub_8ED24CF8中，ooo000()函数先把传进来的flag做一遍base64编码，然后check()函数把编码后的数组进行抑或并与目标数组比较。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __fastcall <span class="title">sub_8ED24CF8</span><span class="params">(JNIEnv *env, <span class="keyword">int</span> jthiz, <span class="keyword">int</span> inputFlag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v4; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v6; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *flag_base64; <span class="comment">// [sp+0h] [bp-18h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v10[<span class="number">8</span>]; <span class="comment">// [sp+4h] [bp-14h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = (*env)-&gt;GetStringUTFChars(env, inputFlag, <span class="number">0</span>);</span><br><span class="line">  ooo000(&amp;flag_base64, v4);<span class="comment">// 换表base64编码</span></span><br><span class="line">  v5 = check(flag_base64);<span class="comment">// 抑或校验</span></span><br><span class="line">  v6 = <span class="string">&quot;tql!!!!&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v5 != <span class="number">1</span> )</span><br><span class="line">    v6 = <span class="string">&quot;啊这。。&quot;</span>;</span><br><span class="line">  v7 = ((*env)-&gt;NewStringUTF)(env, v6, <span class="string">&quot;啊这。。&quot;</span>);</span><br><span class="line">  sub_8ED27710(flag_base64 - <span class="number">12</span>, v10);</span><br><span class="line">  <span class="keyword">return</span> v7;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先看ooo000()函数，代码中出现了相当明显的base64算法，更换了base64映射表。<br>注意<code>appendString(retString, base64table[*(int6_4 + ind) ^ (*(int6_4 + ind) &gt;&gt; 3)]);</code>这段代码。<br>常规的base64，把3个byte转换为4个int6之后，直接把base64table[int6]追加到密文字符串之后就行了。<br>这里加了一点处理，追加的是base64table[ int6 ^ (int6&gt;&gt;3) ]。<br>好在这个过程是可逆的，反过来是:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index = base64table.index(base64cipher[i])</span><br><span class="line">int6 = (index  &amp; <span class="number">0x38</span>) | ((index&gt;&gt;<span class="number">3</span>) ^ (index&amp;<span class="number">0x7</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __fastcall <span class="title">ooo000</span><span class="params">(<span class="keyword">char</span> *retString, <span class="keyword">const</span> <span class="keyword">char</span> *flag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">size_t</span> v5; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// r10</span></span><br><span class="line">  <span class="keyword">int</span> ind; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v8; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v9; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v10; <span class="comment">// r2</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v11; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// r6</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v13; <span class="comment">// r10</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v14; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// r3</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v16; <span class="comment">// r5</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v17; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v18; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">int</span> int6_4[<span class="number">10</span>]; <span class="comment">// [sp+8h] [bp-28h]</span></span><br><span class="line"></span><br><span class="line">  int6_4[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  v4 = sub_8ED28214(retString, &amp;unk_8ED370CE);</span><br><span class="line">  sub_8ED24488(v4);</span><br><span class="line">  v5 = <span class="built_in">strlen</span>(flag);</span><br><span class="line">  <span class="keyword">if</span> ( v5 &lt; <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v12 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      ind = <span class="number">0</span>;</span><br><span class="line">      v8 = flag[<span class="number">3</span> * v6];</span><br><span class="line">      v9 = &amp;flag[<span class="number">3</span> * v6];</span><br><span class="line">      LOBYTE(int6_4[<span class="number">0</span>]) = v8 &gt;&gt; <span class="number">2</span>;</span><br><span class="line">      v10 = v9[<span class="number">1</span>];</span><br><span class="line">      BYTE1(int6_4[<span class="number">0</span>]) = (<span class="number">16</span> * v8) &amp; <span class="number">0x30</span> | (v10 &gt;&gt; <span class="number">4</span>);</span><br><span class="line">      v11 = *(v9 + <span class="number">2</span>);</span><br><span class="line">      BYTE2(int6_4[<span class="number">0</span>]) = (v11 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0xC3</span> | (<span class="number">4</span> * (v10 &amp; <span class="number">0xF</span>));</span><br><span class="line">      HIBYTE(int6_4[<span class="number">0</span>]) = v11 &amp; <span class="number">0x3F</span>;<span class="comment">// 相当明显的base64操作</span></span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        appendString(retString, base64table[*(int6_4 + ind) ^ (*(int6_4 + ind) &gt;&gt; <span class="number">3</span>)]);</span><br><span class="line">        ++ind;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( ind &lt; <span class="number">4</span> );</span><br><span class="line">      v5 = <span class="built_in">strlen</span>(flag);</span><br><span class="line">      ++v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v6 &lt; v5 / <span class="number">3</span> );</span><br><span class="line">    v12 = <span class="number">3</span> * v6;</span><br><span class="line">  &#125;</span><br><span class="line">  v13 = v5 % <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v5 % <span class="number">3</span> )                                 <span class="comment">// 这里在补上==或=</span></span><br><span class="line">  &#123;</span><br><span class="line">    v14 = flag[v12];</span><br><span class="line">    v15 = (<span class="number">16</span> * v14) &amp; <span class="number">0x30</span>;</span><br><span class="line">    LOBYTE(int6_4[<span class="number">0</span>]) = flag[v12] &gt;&gt; <span class="number">2</span>;</span><br><span class="line">    v16 = v15 | (flag[v12 + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>);</span><br><span class="line">    BYTE1(int6_4[<span class="number">0</span>]) = v15 | (flag[v12 + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>);</span><br><span class="line">    appendString(retString, base64table[(v14 &gt;&gt; <span class="number">5</span>) ^ (v14 &gt;&gt; <span class="number">2</span>)]);</span><br><span class="line">    appendString(retString, base64table[v16 ^ (v16 &gt;&gt; <span class="number">3</span>)]);</span><br><span class="line">    <span class="keyword">if</span> ( (v13 &amp; <span class="number">3</span>) == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v17 = (<span class="number">4</span> * flag[v12 + <span class="number">1</span>]) &amp; <span class="number">0x3C</span>;</span><br><span class="line">      v18 = v17 | (flag[v12 + <span class="number">2</span>] &gt;&gt; <span class="number">6</span>);</span><br><span class="line">      BYTE2(int6_4[<span class="number">0</span>]) = v17 | (flag[v12 + <span class="number">2</span>] &gt;&gt; <span class="number">6</span>);</span><br><span class="line">      appendString(retString, base64table[v18 ^ (v17 &gt;&gt; <span class="number">3</span>)]);</span><br><span class="line">      sub_8ED26168(retString, <span class="string">&quot;=&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( (v13 &amp; <span class="number">3</span>) == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_8ED26168(retString, <span class="string">&quot;==&quot;</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _stack_chk_guard - int6_4[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>于是得到一个<code>base64bytes</code>数组，在check函数中对它进行校验。<br>看起来这里的校验逻辑非常复杂，但是不需要一一厘清，只需要关注有意义的那两行代码就好。<br>根据经验加一点点合理的推测，就是先使用xor_key数组把刚刚得到的base64bytes数组抑或成bytesAfterXor数组，然后和aimBytes比较是否一致。<br>aimBytes数组的可以直接提取，xor_key存在于bss段，需要确定生成逻辑。但是因为我是动态调试的，所以直接从内存里面dump出来的。<br>有了这两个数据的具体值，可以还原base64bytes，再根据base64算法，可以还原出flag。<br>代码在最后。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __fastcall <span class="title">check</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *base64bytes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// r10</span></span><br><span class="line">  <span class="keyword">int</span> lens; <span class="comment">// r5</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// r6</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// r1</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// lr</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// r3</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// r0</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// [sp+4h] [bp-D4h]</span></span><br><span class="line">  <span class="keyword">int</span> ind; <span class="comment">// [sp+Ch] [bp-CCh]</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [sp+10h] [bp-C8h]</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [sp+14h] [bp-C4h]</span></span><br><span class="line">  <span class="keyword">int</span> aimBytes[<span class="number">40</span>]; <span class="comment">// [sp+18h] [bp-C0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  qmemcpy(aimBytes, off_8ED37180, <span class="keyword">sizeof</span>(aimBytes));</span><br><span class="line">  lens = <span class="built_in">strlen</span>(base64bytes);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; i = v15 + <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="number">517013752</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v5 == <span class="number">517013752</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v15 = i;</span><br><span class="line">      v5 = <span class="number">-1119517027</span>;</span><br><span class="line">      <span class="keyword">if</span> ( i &lt; <span class="number">256</span> )</span><br><span class="line">        v5 = <span class="number">1985024802</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">-1119517027</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    dword_8ED3B0E8[v15] = v15;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_8ED24684();</span><br><span class="line">  v6 = sub_8ED24978();</span><br><span class="line">  v7 = sub_8ED24A18(v6, lens);</span><br><span class="line">  v8 = <span class="number">2031990082</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v12 = v7;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( v8 &lt;= <span class="number">-44937610</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v8 &gt; <span class="number">-1227108057</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( v8 == <span class="number">-1227108056</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              v10 = <span class="number">1</span>;</span><br><span class="line">LABEL_27:</span><br><span class="line">              v12 = v10;</span><br><span class="line">              v8 = <span class="number">1736361794</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">              v8 = <span class="number">1517945422</span>;</span><br><span class="line">              <span class="keyword">if</span> ( bytesAfterXor[v14] != aimBytes[v14] )</span><br><span class="line">                v8 = <span class="number">1454719996</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> ( v8 == <span class="number">-1972997478</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v14 = v1;</span><br><span class="line">            v8 = <span class="number">-1227108056</span>;</span><br><span class="line">            <span class="keyword">if</span> ( v1 &lt; <span class="number">40</span> )</span><br><span class="line">              v8 = <span class="number">-96183791</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            v8 = <span class="number">0x791DB542</span>;</span><br><span class="line">            bytesAfterXor[ind] = xor_key[<span class="number">4</span> * ind] ^ base64bytes[ind] ^ ind;</span><br><span class="line">            v9 = ind + <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v8 &gt; <span class="number">1517945421</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v8 != <span class="number">-44937609</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v10 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_27;</span><br><span class="line">        &#125;</span><br><span class="line">        v1 = <span class="number">0</span>;</span><br><span class="line">        v8 = <span class="number">-1972997478</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v8 != <span class="number">1517945422</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v8 = <span class="number">-1972997478</span>;</span><br><span class="line">      v1 = v14 + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v8 != <span class="number">2031990082</span> )</span><br><span class="line">      <span class="keyword">return</span> v12;</span><br><span class="line">    ind = v9;</span><br><span class="line">    v8 = <span class="number">-44937609</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v9 &lt; <span class="number">40</span> )</span><br><span class="line">      v8 = <span class="number">-1516589019</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># flag还原代码</span></span><br><span class="line">base64Bytes = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>)]</span><br><span class="line"></span><br><span class="line">base64table=[<span class="number">0x5A</span>, <span class="number">0x4F</span>, <span class="number">0x36</span>, <span class="number">0x4B</span>, <span class="number">0x71</span>, <span class="number">0x37</span>, <span class="number">0x39</span>, <span class="number">0x4C</span>, <span class="number">0x26</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x50</span>, <span class="number">0x57</span>, <span class="number">0x76</span>, <span class="number">0x4E</span>, <span class="number">0x6F</span>, <span class="number">0x70</span>, <span class="number">0x7A</span>, <span class="number">0x51</span>, </span><br><span class="line"><span class="number">0x66</span>, <span class="number">0x67</span>, <span class="number">0x68</span>, <span class="number">0x44</span>, <span class="number">0x52</span>, <span class="number">0x53</span>, <span class="number">0x47</span>, <span class="number">0x40</span>, <span class="number">0x64</span>,</span><br><span class="line"><span class="number">0x69</span>, <span class="number">0x2A</span>, <span class="number">0x6B</span>, <span class="number">0x41</span>, <span class="number">0x42</span>, <span class="number">0x38</span>, <span class="number">0x72</span>, <span class="number">0x73</span>, <span class="number">0x46</span>,</span><br><span class="line"><span class="number">0x65</span>, <span class="number">0x77</span>, <span class="number">0x78</span>, <span class="number">0x6C</span>, <span class="number">0x6D</span>, <span class="number">0x2B</span>, <span class="number">0x2F</span>, <span class="number">0x75</span>, <span class="number">0x35</span>,</span><br><span class="line"><span class="number">0x61</span>, <span class="number">0x5E</span>, <span class="number">0x32</span>, <span class="number">0x59</span>, <span class="number">0x74</span>, <span class="number">0x54</span>, <span class="number">0x4A</span>, <span class="number">0x55</span>, <span class="number">0x56</span>,</span><br><span class="line"><span class="number">0x45</span>, <span class="number">0x6E</span>, <span class="number">0x30</span>, <span class="number">0x24</span>, <span class="number">0x48</span>, <span class="number">0x49</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x79</span>, <span class="number">0x23</span>]</span><br><span class="line"></span><br><span class="line">key= [<span class="number">0xF8</span>, <span class="number">0xA7</span>, <span class="number">0x9E</span>, <span class="number">0xA0</span>, <span class="number">0xC3</span>,</span><br><span class="line"><span class="number">0x66</span>, <span class="number">0x65</span>, <span class="number">0x21</span>, <span class="number">0xD5</span>, <span class="number">0xE0</span>,</span><br><span class="line"><span class="number">0x40</span>, <span class="number">0xA5</span>, <span class="number">0x80</span>, <span class="number">0x87</span>, </span><br><span class="line"><span class="number">0x9B</span>, <span class="number">0xD2</span>, <span class="number">0xCD</span>, <span class="number">0x30</span>, <span class="number">0xBB</span>, </span><br><span class="line"><span class="number">0x6A</span>, <span class="number">0x80</span>, <span class="number">0x21</span>, <span class="number">0xD1</span>, <span class="number">0xD0</span>,</span><br><span class="line"><span class="number">0xE5</span>, <span class="number">0x7F</span>, <span class="number">0xB2</span>, <span class="number">0xE1</span>, </span><br><span class="line"><span class="number">0xE9</span>, <span class="number">0xC4</span>, <span class="number">0x73</span>, <span class="number">0x96</span>, <span class="number">0x90</span>,</span><br><span class="line"><span class="number">0x82</span>, <span class="number">0x21</span>, <span class="number">0x11</span>, <span class="number">0x47</span>, <span class="number">0xD2</span>,</span><br><span class="line"><span class="number">0xC8</span>, <span class="number">0x44</span>]</span><br><span class="line"></span><br><span class="line">aimBytes=[<span class="number">0xA8</span>, <span class="number">0xCE</span>, <span class="number">0xCE</span>, <span class="number">0xD7</span>, <span class="number">0xB1</span>, <span class="number">0x5A</span>, <span class="number">0x20</span>, <span class="number">0x4B</span>, <span class="number">0xAB</span>, <span class="number">0xA2</span>, <span class="number">0x23</span>, <span class="number">0xFA</span>,</span><br><span class="line"><span class="number">0xFC</span>, <span class="number">0xF0</span>, <span class="number">0xDF</span>, <span class="number">0xA5</span>, <span class="number">0xB4</span>, <span class="number">0x77</span>, <span class="number">0xE6</span>, <span class="number">0x41</span>, <span class="number">0xC4</span>, <span class="number">0x65</span>, <span class="number">0x84</span>, <span class="number">0x91</span>,</span><br><span class="line"><span class="number">0x8B</span>, <span class="number">0x0A</span>, <span class="number">0xE6</span>, <span class="number">0xAE</span>, <span class="number">0xBB</span>, <span class="number">0xB5</span>, <span class="number">0x37</span>, <span class="number">0xFD</span>, <span class="number">0xC0</span>, <span class="number">0xCB</span>, <span class="number">0x72</span>, <span class="number">0x78</span>,</span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x91</span>, <span class="number">0xD3</span>, <span class="number">0x5E</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printHexInList</span>(<span class="params">l</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> l:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bin</span>(i)[<span class="number">2</span>:], end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ind <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">40</span>):</span><br><span class="line">    base64Bytes[ind] = aimBytes[ind] ^ key[ind] ^ ind</span><br><span class="line">    <span class="comment"># print(bin(base64Bytes[ind]),end=&#x27;, &#x27;)</span></span><br><span class="line"><span class="comment"># print()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guess3Bytes</span>(<span class="params">int6_4byte</span>):</span></span><br><span class="line">    o_int6_4bytes=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> ind <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(int6_4byte)):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            int6_4byte[ind] = base64table.index(int6_4byte[ind])</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            int6_4byte[ind] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        o_int6_4bytes[i] = (int6_4byte[i] &amp; <span class="number">0x38</span>) | ((int6_4byte[i] ^ (int6_4byte[i] &gt;&gt; <span class="number">3</span>)) &amp; <span class="number">0x7</span> )</span><br><span class="line">    o_3bytes = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">    o_3bytes[<span class="number">0</span>] = ((o_int6_4bytes[<span class="number">0</span>] &lt;&lt; <span class="number">2</span>) | (o_int6_4bytes[<span class="number">1</span>] &gt;&gt; <span class="number">4</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">    o_3bytes[<span class="number">1</span>] = ((o_int6_4bytes[<span class="number">1</span>] &lt;&lt; <span class="number">4</span>) | (o_int6_4bytes[<span class="number">2</span>] &gt;&gt; <span class="number">2</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">    o_3bytes[<span class="number">2</span>] = ((o_int6_4bytes[<span class="number">2</span>] &lt;&lt; <span class="number">6</span>) | (o_int6_4bytes[<span class="number">3</span>] )) &amp; <span class="number">0xff</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># printHexInList(int6_4byte)</span></span><br><span class="line">    <span class="comment"># printHexInList(o_int6_4bytes)</span></span><br><span class="line">    <span class="comment"># printHexInList(o_3bytes)</span></span><br><span class="line">    <span class="comment"># print(&#x27;---------&#x27;)</span></span><br><span class="line">    <span class="keyword">return</span> o_3bytes</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag&#123;e25be952&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> ind <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">40</span>,<span class="number">4</span>):</span><br><span class="line">    g = guess3Bytes(base64Bytes[ind: ind+<span class="number">4</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(g[<span class="number">0</span>])+<span class="built_in">chr</span>(g[<span class="number">1</span>])+<span class="built_in">chr</span>(g[<span class="number">2</span>]), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>一些不足：<br>没有对反调试代码逻辑进行细致的梳理，想着是能过就好。<br>xor_key在bss段，在程序运行过程中生成，没有梳理生成算法，动态调试连过去直接dump内存得到的。</p>
<h1 id="mimic-xctf-hahahaha"><a href="#mimic-xctf-hahahaha" class="headerlink" title="mimic-xctf-hahahaha"></a>mimic-xctf-hahahaha</h1><blockquote>
<p>强网杯 “拟态”比赛 mobile1</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">clip0: 5f384050   -&gt; 5fb84050</span><br><span class="line">clip_i_hash: fc7466e55fbf37b1</span><br><span class="line">clip1: 35315f48  -&gt; b531df48</span><br><span class="line">clip_i_hash: 78b0be39e63b6837</span><br><span class="line">clip2: 7d503131 -&gt;  fdd0b1b1 (rndKeyi=15</span><br><span class="line">clip_i_hash: c2f9c805d0442203</span><br><span class="line">clip3: 7b484035  -&gt; 7b4840b5</span><br><span class="line">clip_i_hash: c11a61bb60d79dab</span><br><span class="line">clip4: 435f3535 -&gt; c3dfb535</span><br><span class="line">clip_i_hash: 869e650ee55bd9f6</span><br><span class="line">clip5: 50314e33  -&gt; 50b14eb3</span><br><span class="line">clip_i_hash: f2dda5fc021fe2bf</span><br><span class="line">clip6: 3348375f -&gt;  b348b7df (rndKeyi=11</span><br><span class="line">clip_i_hash: 305044db48fe6174</span><br><span class="line">clip7: 47414c46 -&gt;  c7414c46 (rndKeyi=8</span><br><span class="line">clip_i_hash: d6659b5e2d1059f8</span><br></pre></td></tr></table></figure>

<p>该题先检查输入是否满足要求，然后基于输入数据生成flag。不过检查逻辑都是基于hash的，所以不能解密得到原文。<br>不过输入的8段数据(8个clip)的检查是相互独立的，所以可以考虑爆破。</p>
<p>接下来分析程序逻辑：</p>
<ol>
<li><p>密钥准备：<br>在<code>WelcomeActivity</code>中，先生成了相关密钥和hash值。<br><code>a.SpecBytesMat</code>是后续计算hash时用到的初始向量矩阵，实际的值是原来值的MD5。<br><code>a.rndKey</code>用于选择hash计算的函数，实际的值是原来值抑或<code>0xAB</code>。<br><code>a.clips_i_hash_mat</code>是8个hash值，也是输入的8个clip的hash值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">a.SpecBytesMat = <span class="keyword">new</span> <span class="keyword">byte</span>[][]&#123;<span class="string">&quot;WIgD1ZNZ0ilJqFpw&quot;</span>.getBytes(), <span class="string">&quot;4811tjOZjoiXpjdq&quot;</span>.getBytes(), <span class="string">&quot;ALFjcgztxnUaC89v&quot;</span>.getBytes(), <span class="string">&quot;ZgHzTu79Zwhoi0PB&quot;</span>.getBytes(), <span class="string">&quot;UYBfajKYrDFE1zJs&quot;</span>.getBytes(), <span class="string">&quot;yr4PBIjlJg89FpP3&quot;</span>.getBytes(), <span class="string">&quot;SFHqaTYDf7EeEevX&quot;</span>.getBytes(), <span class="string">&quot;gUwrqaE3nCxKr4Du&quot;</span>.getBytes()&#125;;</span><br><span class="line">a.rndKeys = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">0xAF</span>, <span class="number">0xA1</span>, <span class="number">0xA4</span>, <span class="number">170</span>, <span class="number">0xA5</span>, <span class="number">0xAE</span>, <span class="number">0xA0</span>, <span class="number">0xA3</span>&#125;;  <span class="comment">//  (xor 0xAB) -&gt; &#123;0x4,0xa,0xf,0x1,0xe,0x5,0xb,0x8&#125;</span></span><br><span class="line">a.clips_i_hash_mat = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;fc7466e55fbf37b1&quot;</span>, <span class="string">&quot;78b0be39e63b6837&quot;</span>, <span class="string">&quot;c2f9c805d0442203&quot;</span>, <span class="string">&quot;c11a61bb60d79dab&quot;</span>, <span class="string">&quot;869e650ee55bd9f6&quot;</span>, <span class="string">&quot;f2dda5fc021fe2bf&quot;</span>, <span class="string">&quot;305044db48fe6174&quot;</span>, <span class="string">&quot;d6659b5e2d1059f8&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WelcomeActivity</span> <span class="keyword">extends</span> <span class="title">h</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// a.b.c.h</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle arg4)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(arg4);</span><br><span class="line">        <span class="keyword">this</span>.setContentView(<span class="number">0x7F0B001D</span>);  <span class="comment">// layout:activity_welcome</span></span><br><span class="line">        <span class="keyword">int</span> ind2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> ind1;  <span class="comment">// xor 0xAB</span></span><br><span class="line">        <span class="keyword">for</span>(ind1 = <span class="number">0</span>; <span class="keyword">true</span>; ++ind1) &#123;  <span class="comment">// xor 0xAB</span></span><br><span class="line">            <span class="keyword">int</span>[] v1 = a.rndKeys;</span><br><span class="line">            <span class="keyword">if</span>(ind1 &gt;= v1.length) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            v1[ind1] ^= <span class="number">0xAB</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(ind2 &lt; a.SpecBytesMat.length) &#123;</span><br><span class="line">            MessageDigest MD5 = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                MD5 = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(NoSuchAlgorithmException v1_1) &#123;</span><br><span class="line">                v1_1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            MD5.update(a.SpecBytesMat[ind2]);</span><br><span class="line">            a.SpecBytesMat[ind2] = MD5.digest();</span><br><span class="line">            ++ind2;  <span class="comment">// Loop MD5 to bytesMat(iteratively)</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.findViewById(<span class="number">0x7F080088</span>).setOnClickListener(<span class="keyword">new</span> WelcomeActivity.click2MainActivity(<span class="keyword">this</span>));  <span class="comment">// id:go_btn</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>输入格式检查<br>先获取输入的8段字符串，然后进行检查。<br>字符串需要是16进制字符串。（不带<code>0x</code>）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">clipsi[<span class="number">0</span>] = v1.p;</span><br><span class="line">clipsi[<span class="number">1</span>] = v1.q;</span><br><span class="line">clipsi[<span class="number">2</span>] = v1.r;</span><br><span class="line">clipsi[<span class="number">3</span>] = v1.s;</span><br><span class="line">clipsi[<span class="number">4</span>] = v1.t;</span><br><span class="line">clipsi[<span class="number">5</span>] = v1.u;</span><br><span class="line">clipsi[<span class="number">6</span>] = v1.v;</span><br><span class="line">clipsi[<span class="number">7</span>] = v1.w;</span><br><span class="line">String[] clips = <span class="keyword">new</span> String[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">int</span> v6 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> v7;</span><br><span class="line"><span class="keyword">for</span>(v7 = <span class="number">0</span>; v6 &lt; <span class="number">8</span>; ++v7) &#123;</span><br><span class="line">    String v8 = clipsi[v6].getText().toString();  <span class="comment">// 要求输入8x8个字符</span></span><br><span class="line">    <span class="keyword">if</span>(v8.length() != <span class="number">8</span>) &#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>.b, <span class="string">&quot;clips must be enough, try again!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    clips[v7] = v8;</span><br><span class="line">    ++v6;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ind = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(ind &lt; <span class="number">8</span>) &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] clips_i_bytes = a.hex2Bytes(clips[ind]);  <span class="comment">// format check 8位16进制字符串</span></span><br><span class="line">    <span class="keyword">if</span>(clips_i_bytes == <span class="keyword">null</span>) &#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>.b, <span class="string">&quot;clips format error, try again!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">        <span class="keyword">while</span>(ind &lt; <span class="number">8</span>) &#123;</span><br><span class="line">            clipsi[ind].setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            ++ind;  <span class="comment">// clean clips</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] hex2Bytes(String arg6) &#123;</span><br><span class="line">    <span class="keyword">int</span> lens = arg6.length();</span><br><span class="line">    <span class="keyword">byte</span>[] v1 = <span class="keyword">new</span> <span class="keyword">byte</span>[lens / <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> ind = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ind &lt; lens) &#123;</span><br><span class="line">        <span class="keyword">int</span> v3 = Character.digit(arg6.charAt(ind), <span class="number">16</span>) &lt;&lt; <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">int</span> v4 = Character.digit(arg6.charAt(ind + <span class="number">1</span>), <span class="number">16</span>);</span><br><span class="line">        <span class="keyword">if</span>(v3 &gt;= <span class="number">0</span> &amp;&amp; v4 &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            v1[ind / <span class="number">2</span>] = (<span class="keyword">byte</span>)(v3 + v4);</span><br><span class="line">            ind += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>格式转换与校验<br>既然每个clip是8位的16进制字符串，那么它等价于4个byte，也即一个<code>int32</code>。<br>于是先转换为4个byte，然后把4个byte的最高位提出来构造为一个<code>int4</code>记作<code>rndKey</code>，然后4个byte只保留剩余的7位记作<code>clips_i_bytes</code>。<br>设当前检查的是第<code>i</code>个clip。<br>接着，调用一个自定义的hash计算函数，要求<code>hash(rndKey, clips_i_bytes)=hash(a.rndKeys[i], clips_i_bytes)=a.clip_i_hash_mat[i]</code>。<br>hash内部是一个更为烧脑的计算逻辑，输入的<code>rndKey</code>会用来选择hash计算算法，输入的<code>clips_i_bytes</code>是hash的原文，如果<code>rndKey&gt;7</code>，会调用<code>a.SpecBytesMat</code>作为hash计算的盐。<br>不过，考虑到hash计算的特性，在<code>rndKey!=a.rndKeys[i]</code>的情况下，<code>hash(rndKey, clips_i_bytes)=hash(a.rndKeys[i], clips_i_bytes)</code>的概率极小，所以不妨直接设定<code>rndKey=a.rndKeys[i]</code>,由于a.rndKeys[i]已知，且rndKey来自于输入的clip，所以这下就确定了4个bit。<br>接下来就是枚举剩余的28个bit，使得<code>hash(a.rndKeys[i], clips_i_bytes)=a.clip_i_hash_mat[i]</code>。（代码见最后）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ind = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(ind &lt; <span class="number">8</span>) &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] clips_i_bytes = a.hex2Bytes(clips[ind]);  <span class="comment">// format check 8位16进制字符串</span></span><br><span class="line">    <span class="keyword">if</span>(clips_i_bytes == <span class="keyword">null</span>) &#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>.b, <span class="string">&quot;clips format error, try again!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">        <span class="keyword">while</span>(ind &lt; <span class="number">8</span>) &#123;</span><br><span class="line">            clipsi[ind].setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            ++ind;  <span class="comment">// clean clips</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> ind3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> rndKey = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ind3 &lt; clips_i_bytes.length) &#123;</span><br><span class="line">        rndKey = rndKey &lt;&lt; <span class="number">1</span> | (clips_i_bytes[ind3] &amp; <span class="number">0x80</span>) &gt;&gt;&gt; <span class="number">7</span>;  <span class="comment">// rndKey 是8个byte的最高位组合</span></span><br><span class="line">        clips_i_bytes[ind3] = (<span class="keyword">byte</span>)(clips_i_bytes[ind3] &amp; <span class="number">0x7F</span>);  <span class="comment">// clips_i_bytes 只保留7位,刚好保证在ASCII范围内</span></span><br><span class="line">        ++ind3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String clips_i_hash = a.hash_int_string_add0_0_16(rndKey, clips_i_bytes);  <span class="comment">// rndKeys[ind] == rndKey</span></span><br><span class="line">    <span class="keyword">if</span>(clips_i_hash != <span class="keyword">null</span> </span><br><span class="line">       &amp;&amp; (clips_i_hash.equals(a.hash_int_string_add0_0_16(a.rndKeys[ind], clips_i_bytes))) </span><br><span class="line">       &amp;&amp; (clips_i_hash.equals(a.clips_i_hash_mat[ind]))) </span><br><span class="line">    &#123;</span><br><span class="line">        ++ind;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>.b, <span class="string">&quot;your clip is not suitable, try again!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">    <span class="keyword">while</span>(ind &lt; <span class="number">8</span>) &#123;</span><br><span class="line">        clipsi[ind].setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        ++ind;  <span class="comment">// clean clips</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">hash_int_string_add0_0_16</span><span class="params">(<span class="keyword">int</span> argRndKey, <span class="keyword">byte</span>[] argBytes)</span> </span>&#123;</span><br><span class="line">    String v0_1;</span><br><span class="line">    <span class="keyword">byte</span>[] argBytes1 = argBytes;</span><br><span class="line">    <span class="keyword">if</span>((argRndKey &gt;&gt;&gt; <span class="number">3</span> &amp; <span class="number">1</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(argRndKey &amp; <span class="number">7</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>: &#123;</span><br><span class="line">                v0_1 = a.SHA512_int_String_add0(argBytes1, a.SpecBytesMat[<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">                v0_1 = a.SHA512_int_String_add0(argBytes1, a.SpecBytesMat[<span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">                v0_1 = a.SHA512_int_String_add0(argBytes1, a.SpecBytesMat[<span class="number">2</span>]);</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: &#123;</span><br><span class="line">                v0_1 = a.SHA512_int_String_add0(argBytes1, a.SpecBytesMat[<span class="number">3</span>]);</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>: &#123;</span><br><span class="line">                v0_1 = a.SHA512_int_String_add0(argBytes1, a.SpecBytesMat[<span class="number">4</span>]);</span><br><span class="line">        		<span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>: &#123;</span><br><span class="line">                v0_1 = a.SHA512_int_String_add0(argBytes1, a.SpecBytesMat[<span class="number">5</span>]);</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>: &#123;</span><br><span class="line">                v0_1 = a.SHA512_int_String_add0(argBytes1, a.SpecBytesMat[<span class="number">6</span>]);</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>: &#123;</span><br><span class="line">                v0_1 = a.SHA512_int_String_add0(argBytes1, a.SpecBytesMat[<span class="number">7</span>]);</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">default</span>: &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> v1 = argRndKey &amp; <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">if</span>(v1 == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                MessageDigest v1_11 = MessageDigest.getInstance(<span class="string">&quot;MD2&quot;</span>);</span><br><span class="line">                v1_11.update(argBytes1);</span><br><span class="line">                <span class="keyword">byte</span>[] v0_13 = v1_11.digest();</span><br><span class="line">                <span class="keyword">char</span>[] v1_12 = <span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>&#125;;</span><br><span class="line">                <span class="keyword">char</span>[] v2_1 = <span class="keyword">new</span> <span class="keyword">char</span>[v0_13.length * <span class="number">2</span>];</span><br><span class="line">                <span class="keyword">int</span> v3_5 = v0_13.length;</span><br><span class="line">                <span class="keyword">int</span> v4_5 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">int</span> v5_1 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span>(v4_5 &lt; v3_5) &#123;</span><br><span class="line">                    <span class="keyword">int</span> v6_1 = v0_13[v4_5];</span><br><span class="line">                    <span class="keyword">int</span> v8_1 = v5_1 + <span class="number">1</span>;</span><br><span class="line">                    v2_1[v5_1] = v1_12[v6_1 &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">15</span>];</span><br><span class="line">                    v5_1 = v8_1 + <span class="number">1</span>;</span><br><span class="line">                    v2_1[v8_1] = v1_12[v6_1 &amp; <span class="number">15</span>];</span><br><span class="line">                    ++v4_5;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                v0_1 = <span class="keyword">new</span> String(v2_1);</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(NoSuchAlgorithmException v0_12) &#123;</span><br><span class="line">                v0_12.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(v1 == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                MessageDigest v1_9 = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">                v1_9.update(argBytes1);</span><br><span class="line">                <span class="keyword">byte</span>[] v0_11 = v1_9.digest();</span><br><span class="line">                <span class="keyword">char</span>[] v1_10 = <span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>&#125;;</span><br><span class="line">                <span class="keyword">char</span>[] v2 = <span class="keyword">new</span> <span class="keyword">char</span>[v0_11.length * <span class="number">2</span>];</span><br><span class="line">                <span class="keyword">int</span> v3_4 = v0_11.length;</span><br><span class="line">                <span class="keyword">int</span> v4_4 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">int</span> v5 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span>(v4_4 &lt; v3_4) &#123;</span><br><span class="line">                    <span class="keyword">int</span> v6 = v0_11[v4_4];</span><br><span class="line">                    <span class="keyword">int</span> v8 = v5 + <span class="number">1</span>;</span><br><span class="line">                    v2[v5] = v1_10[v6 &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">15</span>];</span><br><span class="line">                    v5 = v8 + <span class="number">1</span>;</span><br><span class="line">                    v2[v8] = v1_10[v6 &amp; <span class="number">15</span>];</span><br><span class="line">                    ++v4_4;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                v0_1 = <span class="keyword">new</span> String(v2);</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(NoSuchAlgorithmException v0_10) &#123;</span><br><span class="line">                v0_10.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(v1 == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                MessageDigest v1_7 = MessageDigest.getInstance(<span class="string">&quot;SHA-1&quot;</span>);</span><br><span class="line">                v1_7.update(argBytes1);</span><br><span class="line">                <span class="keyword">byte</span>[] v0_9 = v1_7.digest();</span><br><span class="line">                StringBuilder v1_8 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                <span class="keyword">int</span> v3_3 = v0_9.length;</span><br><span class="line">                <span class="keyword">int</span> v4_3;</span><br><span class="line">                <span class="keyword">for</span>(v4_3 = <span class="number">0</span>; v4_3 &lt; v3_3; ++v4_3) &#123;</span><br><span class="line">                    v1_8.append(String.format(<span class="string">&quot;%02x&quot;</span>, ((<span class="keyword">byte</span>)v0_9[v4_3])));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                v0_1 = v1_8.toString();</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(NoSuchAlgorithmException v0_8) &#123;</span><br><span class="line">                v0_8.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(v1 == <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                MessageDigest v1_5 = MessageDigest.getInstance(<span class="string">&quot;SHA-224&quot;</span>);</span><br><span class="line">                v1_5.update(argBytes1);</span><br><span class="line">                <span class="keyword">byte</span>[] v0_7 = v1_5.digest();</span><br><span class="line">                StringBuilder v1_6 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                <span class="keyword">int</span> v3_2 = v0_7.length;</span><br><span class="line">                <span class="keyword">int</span> v4_2;</span><br><span class="line">                <span class="keyword">for</span>(v4_2 = <span class="number">0</span>; v4_2 &lt; v3_2; ++v4_2) &#123;</span><br><span class="line">                    v1_6.append(String.format(<span class="string">&quot;%02x&quot;</span>, ((<span class="keyword">byte</span>)v0_7[v4_2])));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                v0_1 = v1_6.toString();</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(NoSuchAlgorithmException v0_6) &#123;</span><br><span class="line">                v0_6.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(v1 == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                MessageDigest v1_3 = MessageDigest.getInstance(<span class="string">&quot;SHA-256&quot;</span>);</span><br><span class="line">                v1_3.update(argBytes1);</span><br><span class="line">                <span class="keyword">byte</span>[] v0_5 = v1_3.digest();</span><br><span class="line">                StringBuilder v1_4 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                <span class="keyword">int</span> v3_1 = v0_5.length;</span><br><span class="line">                <span class="keyword">int</span> v4_1;</span><br><span class="line">                <span class="keyword">for</span>(v4_1 = <span class="number">0</span>; v4_1 &lt; v3_1; ++v4_1) &#123;</span><br><span class="line">                    v1_4.append(String.format(<span class="string">&quot;%02x&quot;</span>, ((<span class="keyword">byte</span>)v0_5[v4_1])));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                v0_1 = v1_4.toString();</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(NoSuchAlgorithmException v0_4) &#123;</span><br><span class="line">                v0_4.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(v1 == <span class="number">5</span> &amp;&amp; argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MessageDigest v1_1 = MessageDigest.getInstance(<span class="string">&quot;SHA-384&quot;</span>);</span><br><span class="line">            v1_1.update(argBytes1);</span><br><span class="line">            <span class="keyword">byte</span>[] v0_3 = v1_1.digest();</span><br><span class="line">            StringBuilder v1_2 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">int</span> v3 = v0_3.length;</span><br><span class="line">            <span class="keyword">int</span> v4;</span><br><span class="line">            <span class="keyword">for</span>(v4 = <span class="number">0</span>; v4 &lt; v3; ++v4) &#123;</span><br><span class="line">                v1_2.append(String.format(<span class="string">&quot;%02x&quot;</span>, ((<span class="keyword">byte</span>)v0_3[v4])));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            v0_1 = v1_2.toString();</span><br><span class="line">            <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(NoSuchAlgorithmException v0_2) &#123;</span><br><span class="line">            v0_2.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>flag生成<br>flag的生成如下，不过没怎么关注，因为爆破不需要关注这些。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ind4;</span><br><span class="line"><span class="keyword">for</span>(ind4 = <span class="number">0</span>; ind4 &lt; <span class="number">8</span>; ++ind4) &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] clips_i_bytes = a.hex2Bytes(clips[ind4]);</span><br><span class="line">    <span class="keyword">int</span> ind5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> rndKey1 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ind5 &lt; clips_i_bytes.length) &#123;</span><br><span class="line">        rndKey1 = rndKey1 &lt;&lt; <span class="number">1</span> | (clips_i_bytes[ind5] &amp; <span class="number">0x80</span>) &gt;&gt;&gt; <span class="number">7</span>;</span><br><span class="line">        clips_i_bytes[ind5] = (<span class="keyword">byte</span>)(clips_i_bytes[ind5] &amp; <span class="number">0x7F</span>);</span><br><span class="line">        ++ind5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((rndKey1 &gt;&gt;&gt; <span class="number">3</span> &amp; <span class="number">1</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> ind6;</span><br><span class="line">        <span class="keyword">for</span>(ind6 = <span class="number">0</span>; ind6 &lt; clips_i_bytes.length / <span class="number">2</span>; ++ind6) &#123;</span><br><span class="line">            <span class="keyword">byte</span> v11 = clips_i_bytes[ind6];</span><br><span class="line">            clips_i_bytes[ind6] = clips_i_bytes[clips_i_bytes.length - <span class="number">1</span> - ind6];  <span class="comment">// 把clips_i_bytes倒序一下</span></span><br><span class="line">            clips_i_bytes[clips_i_bytes.length - <span class="number">1</span> - ind6] = v11;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    flag_mat[rndKey1 &amp; <span class="number">7</span>] = <span class="keyword">new</span> String(clips_i_bytes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">StringBuilder finalFlag = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"><span class="keyword">while</span>(v3 &lt; <span class="number">8</span>) &#123;</span><br><span class="line">    finalFlag.append(flag_mat[v3]);</span><br><span class="line">    ++v3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">v0_1.setText(finalFlag.toString());</span><br></pre></td></tr></table></figure></li>
<li><p>爆破<br>爆破的形式多种多样，最方便的当然是用Frida直接Hook爆破，无奈手机计算性能不够。<br>在PC上也不行，因为每个clip一共要尝试268435456个可能。<br>于是我找了个12核的工作站来跑，每秒大概可以尝试262144个可能，十多分钟就能跑出来一个clip。<br>开8个同时找，也能很快出结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.security.InvalidKeyException;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Mac;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="comment">// 爆破第二个clip</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">m1micXctfHaha</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[][] SpecBytesMat =&#123;  hex2Bytes(<span class="string">&quot;2bf07832853b16d0339f1a43900c3481&quot;</span>),</span><br><span class="line">                                            hex2Bytes(<span class="string">&quot;35aaae7322e0e37f3ba0fbcb25981aa7&quot;</span>),</span><br><span class="line">                                            hex2Bytes(<span class="string">&quot;ccb8cc2b84ac701819b738255f518c2d&quot;</span>),</span><br><span class="line">                                            hex2Bytes(<span class="string">&quot;663b77d67c17a0a8d4f12acf35aba2b4&quot;</span>),</span><br><span class="line">                                            hex2Bytes(<span class="string">&quot;9f3a3227ce8bd38475cf317347874d11&quot;</span>),</span><br><span class="line">                                            hex2Bytes(<span class="string">&quot;c08ba12183ecabc899c3957675e28cd9&quot;</span>),</span><br><span class="line">                                            hex2Bytes(<span class="string">&quot;6d330eef823b5c741e37f978488890b1&quot;</span>),</span><br><span class="line">                                            hex2Bytes(<span class="string">&quot;9e99c54e9dcea758cecf0d4cc18a0c22&quot;</span>)&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] rndKeys = &#123;<span class="number">4</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">8</span>&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] clips_i_hash_mat=&#123; <span class="string">&quot;fc7466e55fbf37b1&quot;</span>, <span class="string">&quot;78b0be39e63b6837&quot;</span>, <span class="string">&quot;c2f9c805d0442203&quot;</span>, <span class="string">&quot;c11a61bb60d79dab&quot;</span>, <span class="string">&quot;869e650ee55bd9f6&quot;</span>, <span class="string">&quot;f2dda5fc021fe2bf&quot;</span>, <span class="string">&quot;305044db48fe6174&quot;</span>, <span class="string">&quot;d6659b5e2d1059f8&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String charset3 = <span class="string">&quot;01234567&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String charset4 = <span class="string">&quot;0123456789abcdef&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> c0=<span class="number">0</span>;c0&lt;<span class="number">8</span>;c0++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> c1=<span class="number">0</span>;c1&lt;<span class="number">16</span>;c1++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> c2=<span class="number">0</span>;c2&lt;<span class="number">8</span>;c2++)&#123;</span><br><span class="line"></span><br><span class="line">                    String clip_now = <span class="string">&quot;&quot;</span> + charset3.charAt(c0)+charset4.charAt(c1)+charset3.charAt(c2);</span><br><span class="line">                    System.out.println(clip_now);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> c3=<span class="number">0</span>;c3&lt;<span class="number">16</span>;c3++)&#123;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> c4=<span class="number">0</span>;c4&lt;<span class="number">8</span>;c4++)&#123;</span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> c5=<span class="number">0</span>;c5&lt;<span class="number">16</span>;c5++)&#123;</span><br><span class="line">                                <span class="keyword">for</span>(<span class="keyword">int</span> c6=<span class="number">0</span>;c6&lt;<span class="number">8</span>;c6++)&#123;</span><br><span class="line">                                    <span class="keyword">for</span>(<span class="keyword">int</span> c7=<span class="number">0</span>;c7&lt;<span class="number">16</span>;c7++)&#123;</span><br><span class="line">                                        String clip = <span class="string">&quot;&quot;</span>+charset3.charAt(c0)+charset4.charAt(c1)+charset3.charAt(c2)+charset4.charAt(c3)+charset3.charAt(c4)+charset4.charAt(c5)+charset3.charAt(c6)+charset4.charAt(c7);</span><br><span class="line">                                        <span class="comment">// String clip = &quot;00010567&quot;;</span></span><br><span class="line">                                        <span class="keyword">byte</span>[] clip_bytes = hex2Bytes(clip);</span><br><span class="line">                                        String clip_i_hash = hash_int_string_add0_0_16(<span class="number">10</span>, clip_bytes);</span><br><span class="line"></span><br><span class="line">                                        <span class="comment">// if(clip_i_hash==null)&#123;</span></span><br><span class="line">                                        <span class="comment">//     continue;</span></span><br><span class="line">                                        <span class="comment">// &#125;</span></span><br><span class="line">                                        </span><br><span class="line">                                        <span class="comment">// System.out.println(&quot;clip: &quot;, clip);</span></span><br><span class="line">                                        <span class="comment">// System.out.println(&#x27;clip_i_hash: &#x27;, clip_i_hash);</span></span><br><span class="line">                                        <span class="comment">// return ;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="keyword">if</span>(clip_i_hash.equals(<span class="string">&quot;78b0be39e63b6837&quot;</span>))&#123;</span><br><span class="line">                                            System.out.println(<span class="string">&quot;+++++++\nclip1: &quot;</span> + clip + <span class="string">&quot;rndKeyi=&quot;</span> + <span class="number">10</span>);</span><br><span class="line">                                            System.out.println(<span class="string">&quot;clip_i_hash: &quot;</span> + clip_i_hash);</span><br><span class="line">                                            <span class="keyword">return</span> ;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    </span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;   </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">hash_int_string_add0_0_16</span><span class="params">(<span class="keyword">int</span> argRndKey, <span class="keyword">byte</span>[] argBytes)</span> </span>&#123;</span><br><span class="line">        String v0_1;</span><br><span class="line">        <span class="keyword">byte</span>[] argBytes1 = argBytes;</span><br><span class="line">        <span class="keyword">if</span>((argRndKey &gt;&gt;&gt; <span class="number">3</span> &amp; <span class="number">1</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span>(argRndKey &amp; <span class="number">7</span>) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>: &#123;</span><br><span class="line">                    v0_1 = SHA512_int_String_add0(argBytes1, SpecBytesMat[<span class="number">0</span>]);</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">                    v0_1 = SHA512_int_String_add0(argBytes1, SpecBytesMat[<span class="number">1</span>]);</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">                    v0_1 = SHA512_int_String_add0(argBytes1, SpecBytesMat[<span class="number">2</span>]);</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>: &#123;</span><br><span class="line">                    v0_1 = SHA512_int_String_add0(argBytes1, SpecBytesMat[<span class="number">3</span>]);</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>: &#123;</span><br><span class="line">                    v0_1 = SHA512_int_String_add0(argBytes1, SpecBytesMat[<span class="number">4</span>]);</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>: &#123;</span><br><span class="line">                    v0_1 = SHA512_int_String_add0(argBytes1, SpecBytesMat[<span class="number">5</span>]);</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>: &#123;</span><br><span class="line">                    v0_1 = SHA512_int_String_add0(argBytes1, SpecBytesMat[<span class="number">6</span>]);</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">7</span>: &#123;</span><br><span class="line">                    v0_1 = SHA512_int_String_add0(argBytes1, SpecBytesMat[<span class="number">7</span>]);</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">default</span>: &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> v1 = argRndKey &amp; <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">if</span>(v1 == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    MessageDigest v1_11 = MessageDigest.getInstance(<span class="string">&quot;MD2&quot;</span>);</span><br><span class="line">                    v1_11.update(argBytes1);</span><br><span class="line">                    <span class="keyword">byte</span>[] v0_13 = v1_11.digest();</span><br><span class="line">                    <span class="keyword">char</span>[] v1_12 = <span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>&#125;;</span><br><span class="line">                    <span class="keyword">char</span>[] v2_1 = <span class="keyword">new</span> <span class="keyword">char</span>[v0_13.length * <span class="number">2</span>];</span><br><span class="line">                    <span class="keyword">int</span> v3_5 = v0_13.length;</span><br><span class="line">                    <span class="keyword">int</span> v4_5 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">int</span> v5_1 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">while</span>(v4_5 &lt; v3_5) &#123;</span><br><span class="line">                        <span class="keyword">int</span> v6_1 = v0_13[v4_5];</span><br><span class="line">                        <span class="keyword">int</span> v8_1 = v5_1 + <span class="number">1</span>;</span><br><span class="line">                        v2_1[v5_1] = v1_12[v6_1 &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">15</span>];</span><br><span class="line">                        v5_1 = v8_1 + <span class="number">1</span>;</span><br><span class="line">                        v2_1[v8_1] = v1_12[v6_1 &amp; <span class="number">15</span>];</span><br><span class="line">                        ++v4_5;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    v0_1 = <span class="keyword">new</span> String(v2_1);</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span>(NoSuchAlgorithmException v0_12) &#123;</span><br><span class="line">                    v0_12.printStackTrace();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(v1 == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    MessageDigest v1_9 = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">                    v1_9.update(argBytes1);</span><br><span class="line">                    <span class="keyword">byte</span>[] v0_11 = v1_9.digest();</span><br><span class="line">                    <span class="keyword">char</span>[] v1_10 = <span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>&#125;;</span><br><span class="line">                    <span class="keyword">char</span>[] v2 = <span class="keyword">new</span> <span class="keyword">char</span>[v0_11.length * <span class="number">2</span>];</span><br><span class="line">                    <span class="keyword">int</span> v3_4 = v0_11.length;</span><br><span class="line">                    <span class="keyword">int</span> v4_4 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">int</span> v5 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">while</span>(v4_4 &lt; v3_4) &#123;</span><br><span class="line">                        <span class="keyword">int</span> v6 = v0_11[v4_4];</span><br><span class="line">                        <span class="keyword">int</span> v8 = v5 + <span class="number">1</span>;</span><br><span class="line">                        v2[v5] = v1_10[v6 &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">15</span>];</span><br><span class="line">                        v5 = v8 + <span class="number">1</span>;</span><br><span class="line">                        v2[v8] = v1_10[v6 &amp; <span class="number">15</span>];</span><br><span class="line">                        ++v4_4;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    v0_1 = <span class="keyword">new</span> String(v2);</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span>(NoSuchAlgorithmException v0_10) &#123;</span><br><span class="line">                    v0_10.printStackTrace();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(v1 == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    MessageDigest v1_7 = MessageDigest.getInstance(<span class="string">&quot;SHA-1&quot;</span>);</span><br><span class="line">                    v1_7.update(argBytes1);</span><br><span class="line">                    <span class="keyword">byte</span>[] v0_9 = v1_7.digest();</span><br><span class="line">                    StringBuilder v1_8 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                    <span class="keyword">int</span> v3_3 = v0_9.length;</span><br><span class="line">                    <span class="keyword">int</span> v4_3;</span><br><span class="line">                    <span class="keyword">for</span>(v4_3 = <span class="number">0</span>; v4_3 &lt; v3_3; ++v4_3) &#123;</span><br><span class="line">                        v1_8.append(String.format(<span class="string">&quot;%02x&quot;</span>, ((<span class="keyword">byte</span>)v0_9[v4_3])));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    v0_1 = v1_8.toString();</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span>(NoSuchAlgorithmException v0_8) &#123;</span><br><span class="line">                    v0_8.printStackTrace();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(v1 == <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    MessageDigest v1_5 = MessageDigest.getInstance(<span class="string">&quot;SHA-224&quot;</span>);</span><br><span class="line">                    v1_5.update(argBytes1);</span><br><span class="line">                    <span class="keyword">byte</span>[] v0_7 = v1_5.digest();</span><br><span class="line">                    StringBuilder v1_6 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                    <span class="keyword">int</span> v3_2 = v0_7.length;</span><br><span class="line">                    <span class="keyword">int</span> v4_2;</span><br><span class="line">                    <span class="keyword">for</span>(v4_2 = <span class="number">0</span>; v4_2 &lt; v3_2; ++v4_2) &#123;</span><br><span class="line">                        v1_6.append(String.format(<span class="string">&quot;%02x&quot;</span>, ((<span class="keyword">byte</span>)v0_7[v4_2])));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    v0_1 = v1_6.toString();</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span>(NoSuchAlgorithmException v0_6) &#123;</span><br><span class="line">                    v0_6.printStackTrace();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(v1 == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    MessageDigest v1_3 = MessageDigest.getInstance(<span class="string">&quot;SHA-256&quot;</span>);</span><br><span class="line">                    v1_3.update(argBytes1);</span><br><span class="line">                    <span class="keyword">byte</span>[] v0_5 = v1_3.digest();</span><br><span class="line">                    StringBuilder v1_4 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                    <span class="keyword">int</span> v3_1 = v0_5.length;</span><br><span class="line">                    <span class="keyword">int</span> v4_1;</span><br><span class="line">                    <span class="keyword">for</span>(v4_1 = <span class="number">0</span>; v4_1 &lt; v3_1; ++v4_1) &#123;</span><br><span class="line">                        v1_4.append(String.format(<span class="string">&quot;%02x&quot;</span>, ((<span class="keyword">byte</span>)v0_5[v4_1])));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    v0_1 = v1_4.toString();</span><br><span class="line">                    <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span>(NoSuchAlgorithmException v0_4) &#123;</span><br><span class="line">                    v0_4.printStackTrace();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(v1 == <span class="number">5</span> &amp;&amp; argBytes1.length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                MessageDigest v1_1 = MessageDigest.getInstance(<span class="string">&quot;SHA-384&quot;</span>);</span><br><span class="line">                v1_1.update(argBytes1);</span><br><span class="line">                <span class="keyword">byte</span>[] v0_3 = v1_1.digest();</span><br><span class="line">                StringBuilder v1_2 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                <span class="keyword">int</span> v3 = v0_3.length;</span><br><span class="line">                <span class="keyword">int</span> v4;</span><br><span class="line">                <span class="keyword">for</span>(v4 = <span class="number">0</span>; v4 &lt; v3; ++v4) &#123;</span><br><span class="line">                    v1_2.append(String.format(<span class="string">&quot;%02x&quot;</span>, ((<span class="keyword">byte</span>)v0_3[v4])));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                v0_1 = v1_2.toString();</span><br><span class="line">                <span class="keyword">return</span> v0_1 == <span class="keyword">null</span> ? <span class="keyword">null</span> : v0_1.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(NoSuchAlgorithmException v0_2) &#123;</span><br><span class="line">                v0_2.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">SHA512_int_String_add0</span><span class="params">(<span class="keyword">byte</span>[] arg2, <span class="keyword">byte</span>[] arg3)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SecretKeySpec v1 = <span class="keyword">new</span> SecretKeySpec(arg3, <span class="string">&quot;HmacSha512&quot;</span>);</span><br><span class="line">            Mac v3 = Mac.getInstance(<span class="string">&quot;HmacSha512&quot;</span>);</span><br><span class="line">            v3.init(v1);</span><br><span class="line">            v3.update(arg2);</span><br><span class="line">            String v2_1;  <span class="comment">// hash -&gt; BigInteger -&gt; String</span></span><br><span class="line">            <span class="keyword">for</span>(v2_1 = <span class="keyword">new</span> BigInteger(<span class="number">1</span>, v3.doFinal()).toString(<span class="number">16</span>); v2_1.length() &lt; <span class="number">32</span>; v2_1 = <span class="string">&quot;0&quot;</span> + v2_1) &#123;  <span class="comment">// hash -&gt; BigInteger -&gt; String</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> v2_1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(NoSuchAlgorithmException | InvalidKeyException v2) &#123;</span><br><span class="line">            v2.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] hex2Bytes(String arg6) &#123;</span><br><span class="line">        <span class="keyword">int</span> lens = arg6.length();</span><br><span class="line">        <span class="keyword">byte</span>[] v1 = <span class="keyword">new</span> <span class="keyword">byte</span>[lens / <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">int</span> ind = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(ind &lt; lens) &#123;</span><br><span class="line">            <span class="keyword">int</span> v3 = Character.digit(arg6.charAt(ind), <span class="number">16</span>) &lt;&lt; <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">int</span> v4 = Character.digit(arg6.charAt(ind + <span class="number">1</span>), <span class="number">16</span>);</span><br><span class="line">            <span class="keyword">if</span>(v3 &gt;= <span class="number">0</span> &amp;&amp; v4 &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                v1[ind / <span class="number">2</span>] = (<span class="keyword">byte</span>)(v3 + v4);</span><br><span class="line">                ind += <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> v1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/slient2009/PicGo/main/img/Snipaste_2021-00-52-201.png" alt="Snipaste_2021-00-52-201" style="zoom:33%;" /></li>
</ol>
<h1 id="mimic-xctf-studydesk"><a href="#mimic-xctf-studydesk" class="headerlink" title="mimic-xctf-studydesk"></a>mimic-xctf-studydesk</h1><blockquote>
<p>强网杯 “拟态”比赛 mobile2</p>
</blockquote>
<p>当时做完了mobile1比较晚了，就没怎么细看这个题，没想到挺简单的。</p>
<p>flag要求长度为32，也就是32个byte，然后进行了一系列的处理。<br>引入了一个静态byte数组staticBytes，长度为288。对于其中的每个byte，去flag中查找下标，即<code>ind=flag.index(staticBytes[i])</code>。<br>因为flag本身长度为32，所以0&lt;ind&lt;32，所以保存为5bit，总共得到1440bit。<br>然后分割得到180个byte，记作<code>byteArray</code>，并将其与目标数组<code>aimBytes</code>比较。</p>
<p><code>aimBytes</code>的生成比较烧脑，但还好它是输入无关的。<br>把代码copy出来跑一遍，可以发现生成的是圆周率3.1415926……<br>把pi值转换成string，去掉小数点，每相邻两个数字处理为一个byte，得到<code>aimBytes</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">BigDecimal v2_1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">BigDecimal v3_1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">BigDecimal v4_2 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;6&quot;</span>);</span><br><span class="line">MathContext MathCtx1 = <span class="keyword">new</span> MathContext(<span class="number">360</span>, RoundingMode.HALF_UP);  <span class="comment">// (digits, roundingMode)</span></span><br><span class="line">MathContext MathCtx2 = <span class="keyword">new</span> MathContext(<span class="number">720</span>, RoundingMode.HALF_UP);</span><br><span class="line"><span class="keyword">int</span> inds = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">    v2_1 = a.a(<span class="keyword">new</span> BigDecimal(<span class="string">&quot;2&quot;</span>).subtract(a.a(<span class="keyword">new</span> BigDecimal(<span class="number">4</span>).subtract(v2_1.multiply(v2_1, MathCtx2), MathCtx2), MathCtx2)), MathCtx2);</span><br><span class="line">    v4_2 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;2&quot;</span>).multiply(v4_2, MathCtx1);</span><br><span class="line">    v10 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;0.5&quot;</span>).multiply(v2_1.multiply(v4_2, MathCtx1), MathCtx1);</span><br><span class="line">    <span class="keyword">if</span>(v10.compareTo(v3_1) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ++inds;</span><br><span class="line">    <span class="keyword">if</span>(inds % <span class="number">30</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        StringBuilder v3_2 = b.a.a.a.a.e(<span class="string">&quot;running: &quot;</span>);</span><br><span class="line">        v3_2.append(inds / <span class="number">6</span>);</span><br><span class="line">        v3_2.append(<span class="string">&quot;%&quot;</span>);</span><br><span class="line">        Log.i(<span class="string">&quot;StudyDesk:&quot;</span>, v3_2.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v3_1 = v10;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Log.i(<span class="string">&quot;StudyDesk:&quot;</span>, <span class="string">&quot;running: 100%&quot;</span>);</span><br><span class="line">String aimString = v10.toString().replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>解密代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pi = <span class="string">&quot;314159265358979323846264338327950288419716939937510582097494459230781640628620899862803482534211706798214808651328230664709384460955058223172535940812848111745028410270193852110555964462294895493038196442881097566593344612847564823378678316527120190914564856692346034861045432664821339360726024914127372458700660631558817488152092096282925409171536436789259036&quot;</span></span><br><span class="line">aimBytes = []</span><br><span class="line"><span class="keyword">for</span> ind <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(pi), <span class="number">2</span>):</span><br><span class="line">    aimBytes.append(<span class="built_in">int</span>(pi[ind:ind+<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line">staticBytes = [<span class="number">0x73</span>, <span class="number">0x6F</span>, <span class="number">43</span>, <span class="number">0x72</span>, <span class="number">0x74</span>, <span class="number">45</span>, <span class="number">0x30</span>, <span class="number">36</span>, <span class="number">84</span>, <span class="number">98</span>, <span class="number">89</span>, <span class="number">36</span>, <span class="number">38</span>, <span class="number">66</span>, <span class="number">38</span>, <span class="number">43</span>, <span class="number">84</span>, <span class="number">0x79</span>, <span class="number">50</span>, <span class="number">101</span>, <span class="number">101</span>, <span class="number">43</span>, <span class="number">100</span>, <span class="number">87</span>, <span class="number">69</span>, <span class="number">0x6F</span>, <span class="number">51</span>, <span class="number">66</span>, <span class="number">89</span>, <span class="number">49</span>, <span class="number">69</span>, <span class="number">51</span>, <span class="number">101</span>, <span class="number">51</span>, <span class="number">53</span>, <span class="number">0x74</span>, <span class="number">45</span>, <span class="number">98</span>, <span class="number">98</span>, <span class="number">0x72</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">98</span>, <span class="number">50</span>, <span class="number">85</span>, <span class="number">85</span>, <span class="number">85</span>, <span class="number">107</span>, <span class="number">66</span>, <span class="number">36</span>, <span class="number">53</span>, <span class="number">51</span>, <span class="number">0x6F</span>, <span class="number">0x72</span>, <span class="number">89</span>, <span class="number">89</span>, <span class="number">66</span>, <span class="number">50</span>, <span class="number">33</span>, <span class="number">66</span>, <span class="number">0x5F</span>, <span class="number">66</span>, <span class="number">101</span>, <span class="number">0x79</span>, <span class="number">0x5F</span>, <span class="number">0x40</span>, <span class="number">33</span>, <span class="number">66</span>, <span class="number">50</span>, <span class="number">0x40</span>, <span class="number">85</span>, <span class="number">85</span>, <span class="number">45</span>, <span class="number">43</span>, <span class="number">36</span>, <span class="number">50</span>, <span class="number">0x74</span>, <span class="number">0x30</span>, <span class="number">85</span>, <span class="number">0x73</span>, <span class="number">0x5F</span>, <span class="number">0x40</span>, <span class="number">49</span>, <span class="number">0x72</span>, <span class="number">50</span>, <span class="number">101</span>, <span class="number">101</span>, <span class="number">51</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">53</span>, <span class="number">51</span>, <span class="number">53</span>, <span class="number">51</span>, <span class="number">85</span>, <span class="number">50</span>, <span class="number">0x40</span>, <span class="number">0x79</span>, <span class="number">53</span>, <span class="number">36</span>, <span class="number">0x40</span>, <span class="number">69</span>, <span class="number">89</span>, <span class="number">98</span>, <span class="number">45</span>, <span class="number">0x6F</span>, <span class="number">101</span>, <span class="number">36</span>, <span class="number">97</span>, <span class="number">66</span>, <span class="number">100</span>, <span class="number">0x30</span>, <span class="number">0x73</span>, <span class="number">97</span>, <span class="number">0x30</span>, <span class="number">36</span>, <span class="number">0x6F</span>, <span class="number">101</span>, <span class="number">50</span>, <span class="number">0x5F</span>, <span class="number">49</span>, <span class="number">0x30</span>, <span class="number">0x40</span>, <span class="number">89</span>, <span class="number">0x74</span>, <span class="number">85</span>, <span class="number">0x30</span>, <span class="number">85</span>, <span class="number">0x73</span>, <span class="number">89</span>, <span class="number">43</span>, <span class="number">89</span>, <span class="number">97</span>, <span class="number">0x30</span>, <span class="number">89</span>, <span class="number">0x72</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">38</span>, <span class="number">50</span>, <span class="number">0x74</span>, <span class="number">51</span>, <span class="number">98</span>, <span class="number">0x75</span>, <span class="number">0x5F</span>, <span class="number">50</span>, <span class="number">0x74</span>, <span class="number">0x73</span>, <span class="number">0x6F</span>, <span class="number">84</span>, <span class="number">98</span>, <span class="number">89</span>, <span class="number">69</span>, <span class="number">0x6F</span>, <span class="number">100</span>, <span class="number">0x30</span>, <span class="number">0x6F</span>, <span class="number">98</span>, <span class="number">89</span>, <span class="number">0x72</span>, <span class="number">0x40</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">66</span>, <span class="number">89</span>, <span class="number">101</span>, <span class="number">0x72</span>, <span class="number">51</span>, <span class="number">84</span>, <span class="number">51</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">38</span>, <span class="number">0x40</span>, <span class="number">0x30</span>, <span class="number">53</span>, <span class="number">51</span>, <span class="number">0x30</span>, <span class="number">49</span>, <span class="number">97</span>, <span class="number">0x74</span>, <span class="number">89</span>, <span class="number">101</span>, <span class="number">85</span>, <span class="number">97</span>, <span class="number">66</span>, <span class="number">84</span>, <span class="number">97</span>, <span class="number">45</span>, <span class="number">43</span>, <span class="number">100</span>, <span class="number">89</span>, <span class="number">45</span>, <span class="number">0x30</span>, <span class="number">0x73</span>, <span class="number">0x30</span>, <span class="number">0x40</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">98</span>, <span class="number">51</span>, <span class="number">100</span>, <span class="number">0x6F</span>, <span class="number">0x73</span>, <span class="number">50</span>, <span class="number">53</span>, <span class="number">101</span>, <span class="number">66</span>, <span class="number">101</span>, <span class="number">0x6F</span>, <span class="number">0x75</span>, <span class="number">50</span>, <span class="number">45</span>, <span class="number">0x5F</span>, <span class="number">51</span>, <span class="number">82</span>, <span class="number">50</span>, <span class="number">89</span>, <span class="number">87</span>, <span class="number">101</span>, <span class="number">50</span>, <span class="number">89</span>, <span class="number">0x30</span>, <span class="number">89</span>, <span class="number">101</span>, <span class="number">43</span>, <span class="number">89</span>, <span class="number">36</span>, <span class="number">38</span>, <span class="number">61</span>, <span class="number">101</span>, <span class="number">0x40</span>, <span class="number">84</span>, <span class="number">89</span>, <span class="number">0x5F</span>, <span class="number">66</span>, <span class="number">0x74</span>, <span class="number">49</span>, <span class="number">0x40</span>, <span class="number">87</span>, <span class="number">97</span>, <span class="number">43</span>, <span class="number">0x5F</span>, <span class="number">0x73</span>, <span class="number">43</span>, <span class="number">0x30</span>, <span class="number">89</span>, <span class="number">45</span>, <span class="number">84</span>, <span class="number">89</span>, <span class="number">33</span>, <span class="number">89</span>, <span class="number">107</span>, <span class="number">53</span>, <span class="number">85</span>, <span class="number">0x30</span>, <span class="number">98</span>, <span class="number">98</span>, <span class="number">0x5F</span>, <span class="number">50</span>, <span class="number">107</span>, <span class="number">66</span>, <span class="number">101</span>, <span class="number">0x6F</span>, <span class="number">51</span>, <span class="number">97</span>, <span class="number">33</span>, <span class="number">66</span>, <span class="number">97</span>, <span class="number">0x75</span>, <span class="number">51</span>, <span class="number">0x74</span>, <span class="number">51</span>, <span class="number">97</span>, <span class="number">0x40</span>, <span class="number">89</span>, <span class="number">107</span>, <span class="number">98</span>, <span class="number">51</span>, <span class="number">69</span>, <span class="number">0x40</span>, <span class="number">73</span>, <span class="number">0x5F</span>, <span class="number">0x30</span>, <span class="number">85</span>, <span class="number">0x74</span>, <span class="number">0x30</span>, <span class="number">97</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bit8</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bin</span>(x)[<span class="number">2</span>:].rjust(<span class="number">8</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">flagTable = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">sb_index = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> ind <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">180</span>, <span class="number">5</span>):</span><br><span class="line">    binString = bit8(aimBytes[ind])+bit8(aimBytes[ind+<span class="number">1</span>])+bit8(aimBytes[ind+<span class="number">2</span>])+bit8(aimBytes[ind+<span class="number">3</span>])+bit8(aimBytes[ind+<span class="number">4</span>])</span><br><span class="line">    <span class="keyword">for</span> indd <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(binString), <span class="number">5</span>):</span><br><span class="line">        index = <span class="built_in">int</span>(binString[indd:indd+<span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">        flagTable[index] = staticBytes[sb_index]</span><br><span class="line">        sb_index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nflag: &quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flagTable:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h1 id="卖瓜"><a href="#卖瓜" class="headerlink" title="卖瓜"></a>卖瓜</h1><blockquote>
<p>中科大信安比赛</p>
</blockquote>
<p>猜测后台计算公式如下：</p>
<p>$$<br>   new_weight = old_weight + 6 \times b6 + 9 \times b9<br>$$</p>
<p>根据运算符的优先级，计算顺序如下：<br>$$<br>   new_weight = old_weight + (6 \times b6) + (9 \times b9)<br>$$</p>
<p>PHP 64位系统下，INT最大值是<code>9223372036854775807</code>，超出这个数字会被解释为float。<br>这里的乘法应该是用<code>9223372036854775807</code>作为最大值，但是加法的最大值更大。<br>或者说一旦构造了一个超过<code>9223372036854775807</code>的数字，系统里面的数值就被解释为float了，造成最大值变大。</p>
<p>总的来说，我们希望构造参数，使得 $(6 \times b6)$ 和$(9 \times b9)$偶尔溢出为负数的float，然后追加整数构造出20.</p>
<p>构造步骤如下：<br> <code>1024819115206086201 * 9 = 9223372036854775809 -&gt;(溢出为)-&gt; -9223372036854775808</code><br><code>-9223372036854775808 + 1024819115206086200 * 9 = -8</code><br> <code>-8 +  1024819115206086200 * 9 = 9223372036854775792</code><br> <code>9223372036854775792 + 1024819115206086201 * 9 = 9223372036854775792 + -9223372036854775808 = -16</code><br> <code>-16 + 6 * 6 = 20</code></p>
<p><img src="https://raw.githubusercontent.com/slient2009/PicGo/main/img/image-20211026132532729.png" alt="image-20211026132532729"></p>
<h1 id="bytecode"><a href="#bytecode" class="headerlink" title="bytecode"></a>bytecode</h1><blockquote>
<p>天津市大学生信息安全大赛</p>
</blockquote>
<p>给出一条python的字节码代码，常见题型，人脑模拟逆向。可是我当时把<code>BINARY_AND</code>看成<code>BINARY_ADD</code>，然后没及时做出来。（恼<br><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.8/library/dis.html">dis – Python字节码反汇编器</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br></pre></td><td class="code"><pre><span class="line">Disassembly of main:</span><br><span class="line"> <span class="number">27</span>           <span class="number">0</span> LOAD_CONST               <span class="number">1</span> (<span class="number">305419896</span>)</span><br><span class="line">              <span class="number">2</span> LOAD_CONST               <span class="number">2</span> (<span class="number">2271560481</span>)</span><br><span class="line">              <span class="number">4</span> LOAD_CONST               <span class="number">3</span> (<span class="number">2427178479</span>)</span><br><span class="line">              <span class="number">6</span> LOAD_CONST               <span class="number">4</span> (<span class="number">4275878409</span>)</span><br><span class="line">              <span class="number">8</span> BUILD_LIST               <span class="number">4</span></span><br><span class="line">             <span class="number">10</span> STORE_FAST               <span class="number">0</span> (key)</span><br><span class="line"></span><br><span class="line"> <span class="number">28</span>          <span class="number">12</span> LOAD_CONST               <span class="number">5</span> (<span class="number">3888592564</span>)</span><br><span class="line">             <span class="number">14</span> LOAD_CONST               <span class="number">6</span> (<span class="number">3737879155</span>)</span><br><span class="line">             <span class="number">16</span> BUILD_LIST               <span class="number">2</span></span><br><span class="line">             <span class="number">18</span> LOAD_CONST               <span class="number">7</span> (<span class="number">4063334467</span>)</span><br><span class="line">             <span class="number">20</span> LOAD_CONST               <span class="number">8</span> (<span class="number">2214487552</span>)</span><br><span class="line">             <span class="number">22</span> BUILD_LIST               <span class="number">2</span></span><br><span class="line">             <span class="number">24</span> LOAD_CONST               <span class="number">9</span> (<span class="number">2420456096</span>)</span><br><span class="line">             <span class="number">26</span> LOAD_CONST              <span class="number">10</span> (<span class="number">1529806583</span>)</span><br><span class="line">             <span class="number">28</span> BUILD_LIST               <span class="number">2</span></span><br><span class="line">             <span class="number">30</span> LOAD_CONST              <span class="number">11</span> (<span class="number">2576007368</span>)</span><br><span class="line">             <span class="number">32</span> LOAD_CONST              <span class="number">12</span> (<span class="number">2328179940</span>)</span><br><span class="line">             <span class="number">34</span> BUILD_LIST               <span class="number">2</span></span><br><span class="line">             <span class="number">36</span> LOAD_CONST              <span class="number">13</span> (<span class="number">1665686107</span>)</span><br><span class="line">             <span class="number">38</span> LOAD_CONST              <span class="number">14</span> (<span class="number">1748819876</span>)</span><br><span class="line">             <span class="number">40</span> BUILD_LIST               <span class="number">2</span></span><br><span class="line">             <span class="number">42</span> BUILD_LIST               <span class="number">5</span></span><br><span class="line">             <span class="number">44</span> STORE_FAST               <span class="number">1</span> (arr)</span><br><span class="line"></span><br><span class="line"> <span class="number">29</span>          <span class="number">46</span> LOAD_GLOBAL              <span class="number">0</span> (<span class="built_in">input</span>)</span><br><span class="line">             <span class="number">48</span> LOAD_CONST              <span class="number">15</span> (<span class="string">&#x27;please input your secret key: &#x27;</span>)</span><br><span class="line">             <span class="number">50</span> CALL_FUNCTION            <span class="number">1</span></span><br><span class="line">             <span class="number">52</span> STORE_FAST               <span class="number">2</span> (flag)</span><br><span class="line"></span><br><span class="line"> <span class="number">31</span>          <span class="number">54</span> BUILD_LIST               <span class="number">0</span></span><br><span class="line">             <span class="number">56</span> STORE_FAST               <span class="number">3</span> (encry)</span><br><span class="line"></span><br><span class="line"> <span class="number">32</span>          <span class="number">58</span> BUILD_LIST               <span class="number">0</span></span><br><span class="line">             <span class="number">60</span> STORE_FAST               <span class="number">4</span> (encryted)</span><br><span class="line"></span><br><span class="line"> <span class="number">33</span>          <span class="number">62</span> LOAD_GLOBAL              <span class="number">1</span> (<span class="built_in">range</span>)</span><br><span class="line">             <span class="number">64</span> LOAD_CONST              <span class="number">16</span> (<span class="number">0</span>)</span><br><span class="line">             <span class="number">66</span> LOAD_GLOBAL              <span class="number">2</span> (<span class="built_in">len</span>)</span><br><span class="line">             <span class="number">68</span> LOAD_FAST                <span class="number">2</span> (flag)</span><br><span class="line">             <span class="number">70</span> CALL_FUNCTION            <span class="number">1</span></span><br><span class="line">             <span class="number">72</span> LOAD_CONST              <span class="number">17</span> (<span class="number">8</span>)</span><br><span class="line">             <span class="number">74</span> CALL_FUNCTION            <span class="number">3</span></span><br><span class="line">             <span class="number">76</span> GET_ITER</span><br><span class="line">        &gt;&gt;   <span class="number">78</span> FOR_ITER               <span class="number">112</span> (to <span class="number">192</span>)</span><br><span class="line">             <span class="number">80</span> STORE_FAST               <span class="number">5</span> (i)</span><br><span class="line"></span><br><span class="line"> <span class="number">34</span>          <span class="number">82</span> LOAD_FAST                <span class="number">3</span> (encry)</span><br><span class="line">             <span class="number">84</span> LOAD_METHOD              <span class="number">3</span> (append)</span><br><span class="line">             <span class="number">86</span> LOAD_GLOBAL              <span class="number">4</span> (struct)</span><br><span class="line">             <span class="number">88</span> LOAD_METHOD              <span class="number">5</span> (unpack)</span><br><span class="line">             <span class="number">90</span> LOAD_CONST              <span class="number">18</span> (<span class="string">&#x27;&lt;I&#x27;</span>)</span><br><span class="line">             <span class="number">92</span> LOAD_FAST                <span class="number">2</span> (flag)</span><br><span class="line">             <span class="number">94</span> LOAD_FAST                <span class="number">5</span> (i)</span><br><span class="line">             <span class="number">96</span> LOAD_FAST                <span class="number">5</span> (i)</span><br><span class="line">             <span class="number">98</span> LOAD_CONST              <span class="number">19</span> (<span class="number">4</span>)</span><br><span class="line">            <span class="number">100</span> BINARY_ADD</span><br><span class="line">            <span class="number">102</span> BUILD_SLICE              <span class="number">2</span></span><br><span class="line">            <span class="number">104</span> BINARY_SUBSCR</span><br><span class="line">            <span class="number">106</span> LOAD_METHOD              <span class="number">6</span> (encode)</span><br><span class="line">            <span class="number">108</span> LOAD_CONST              <span class="number">20</span> (<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="number">110</span> CALL_METHOD              <span class="number">1</span></span><br><span class="line">            <span class="number">112</span> CALL_METHOD              <span class="number">2</span></span><br><span class="line">            <span class="number">114</span> LOAD_CONST              <span class="number">16</span> (<span class="number">0</span>)</span><br><span class="line">            <span class="number">116</span> BINARY_SUBSCR</span><br><span class="line">            <span class="number">118</span> CALL_METHOD              <span class="number">1</span></span><br><span class="line">            <span class="number">120</span> POP_TOP</span><br><span class="line"></span><br><span class="line"> <span class="number">35</span>         <span class="number">122</span> LOAD_FAST                <span class="number">3</span> (encry)</span><br><span class="line">            <span class="number">124</span> LOAD_METHOD              <span class="number">3</span> (append)</span><br><span class="line">            <span class="number">126</span> LOAD_GLOBAL              <span class="number">4</span> (struct)</span><br><span class="line">            <span class="number">128</span> LOAD_METHOD              <span class="number">5</span> (unpack)</span><br><span class="line">            <span class="number">130</span> LOAD_CONST              <span class="number">18</span> (<span class="string">&#x27;&lt;I&#x27;</span>)</span><br><span class="line">            <span class="number">132</span> LOAD_FAST                <span class="number">2</span> (flag)</span><br><span class="line">            <span class="number">134</span> LOAD_FAST                <span class="number">5</span> (i)</span><br><span class="line">            <span class="number">136</span> LOAD_CONST              <span class="number">19</span> (<span class="number">4</span>)</span><br><span class="line">            <span class="number">138</span> BINARY_ADD</span><br><span class="line">            <span class="number">140</span> LOAD_FAST                <span class="number">5</span> (i)</span><br><span class="line">            <span class="number">142</span> LOAD_CONST              <span class="number">17</span> (<span class="number">8</span>)</span><br><span class="line">            <span class="number">144</span> BINARY_ADD</span><br><span class="line">            <span class="number">146</span> BUILD_SLICE              <span class="number">2</span></span><br><span class="line">            <span class="number">148</span> BINARY_SUBSCR</span><br><span class="line">            <span class="number">150</span> LOAD_METHOD              <span class="number">6</span> (encode)</span><br><span class="line">            <span class="number">152</span> LOAD_CONST              <span class="number">20</span> (<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="number">154</span> CALL_METHOD              <span class="number">1</span></span><br><span class="line">            <span class="number">156</span> CALL_METHOD              <span class="number">2</span></span><br><span class="line">            <span class="number">158</span> LOAD_CONST              <span class="number">16</span> (<span class="number">0</span>)</span><br><span class="line">            <span class="number">160</span> BINARY_SUBSCR</span><br><span class="line">            <span class="number">162</span> CALL_METHOD              <span class="number">1</span></span><br><span class="line">            <span class="number">164</span> POP_TOP</span><br><span class="line"></span><br><span class="line"> <span class="number">36</span>         <span class="number">166</span> LOAD_GLOBAL              <span class="number">7</span> (encrypt)</span><br><span class="line">            <span class="number">168</span> LOAD_FAST                <span class="number">3</span> (encry)</span><br><span class="line">            <span class="number">170</span> LOAD_FAST                <span class="number">0</span> (key)</span><br><span class="line">            <span class="number">172</span> CALL_FUNCTION            <span class="number">2</span></span><br><span class="line">            <span class="number">174</span> STORE_FAST               <span class="number">6</span> (encrypted)</span><br><span class="line"></span><br><span class="line"> <span class="number">37</span>         <span class="number">176</span> LOAD_FAST                <span class="number">4</span> (encryted)</span><br><span class="line">            <span class="number">178</span> LOAD_METHOD              <span class="number">3</span> (append)</span><br><span class="line">            <span class="number">180</span> LOAD_FAST                <span class="number">6</span> (encrypted)</span><br><span class="line">            <span class="number">182</span> CALL_METHOD              <span class="number">1</span></span><br><span class="line">            <span class="number">184</span> POP_TOP</span><br><span class="line"></span><br><span class="line"> <span class="number">38</span>         <span class="number">186</span> BUILD_LIST               <span class="number">0</span></span><br><span class="line">            <span class="number">188</span> STORE_FAST               <span class="number">3</span> (encry)</span><br><span class="line">            <span class="number">190</span> JUMP_ABSOLUTE           <span class="number">78</span></span><br><span class="line"></span><br><span class="line"> <span class="number">39</span>     &gt;&gt;  <span class="number">192</span> LOAD_FAST                <span class="number">4</span> (encryted)</span><br><span class="line">            <span class="number">194</span> LOAD_FAST                <span class="number">1</span> (arr)</span><br><span class="line">            <span class="number">196</span> COMPARE_OP               <span class="number">2</span> (==)</span><br><span class="line">            <span class="number">198</span> POP_JUMP_IF_FALSE      <span class="number">210</span></span><br><span class="line"></span><br><span class="line"> <span class="number">40</span>         <span class="number">200</span> LOAD_GLOBAL              <span class="number">8</span> (<span class="built_in">print</span>)</span><br><span class="line">            <span class="number">202</span> LOAD_CONST              <span class="number">21</span> (<span class="string">&#x27;ok,fine~&#x27;</span>)</span><br><span class="line">            <span class="number">204</span> CALL_FUNCTION            <span class="number">1</span></span><br><span class="line">            <span class="number">206</span> POP_TOP</span><br><span class="line">            <span class="number">208</span> JUMP_FORWARD             <span class="number">8</span> (to <span class="number">218</span>)</span><br><span class="line"></span><br><span class="line"> <span class="number">42</span>     &gt;&gt;  <span class="number">210</span> LOAD_GLOBAL              <span class="number">8</span> (<span class="built_in">print</span>)</span><br><span class="line">            <span class="number">212</span> LOAD_CONST              <span class="number">22</span> (<span class="string">&#x27;sry~&#x27;</span>)</span><br><span class="line">            <span class="number">214</span> CALL_FUNCTION            <span class="number">1</span></span><br><span class="line">            <span class="number">216</span> POP_TOP</span><br><span class="line">        &gt;&gt;  <span class="number">218</span> LOAD_CONST               <span class="number">0</span> (<span class="literal">None</span>)</span><br><span class="line">            <span class="number">220</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of encrypt:</span><br><span class="line">  <span class="number">6</span>           <span class="number">0</span> LOAD_FAST                <span class="number">0</span> (v)</span><br><span class="line">              <span class="number">2</span> LOAD_CONST               <span class="number">1</span> (<span class="number">0</span>)</span><br><span class="line">              <span class="number">4</span> BINARY_SUBSCR</span><br><span class="line">              <span class="number">6</span> STORE_FAST               <span class="number">2</span> (v0)</span><br><span class="line"></span><br><span class="line">  <span class="number">7</span>           <span class="number">8</span> LOAD_FAST                <span class="number">0</span> (v)</span><br><span class="line">             <span class="number">10</span> LOAD_CONST               <span class="number">2</span> (<span class="number">1</span>)</span><br><span class="line">             <span class="number">12</span> BINARY_SUBSCR</span><br><span class="line">             <span class="number">14</span> STORE_FAST               <span class="number">3</span> (v1)</span><br><span class="line"></span><br><span class="line">  <span class="number">8</span>          <span class="number">16</span> LOAD_CONST               <span class="number">1</span> (<span class="number">0</span>)</span><br><span class="line">             <span class="number">18</span> STORE_FAST               <span class="number">4</span> (x)</span><br><span class="line"></span><br><span class="line">  <span class="number">9</span>          <span class="number">20</span> LOAD_CONST               <span class="number">3</span> (<span class="number">6710886</span>)</span><br><span class="line">             <span class="number">22</span> STORE_FAST               <span class="number">5</span> (delta)</span><br><span class="line"></span><br><span class="line"> <span class="number">10</span>          <span class="number">24</span> LOAD_FAST                <span class="number">1</span> (k)</span><br><span class="line">             <span class="number">26</span> LOAD_CONST               <span class="number">1</span> (<span class="number">0</span>)</span><br><span class="line">             <span class="number">28</span> BINARY_SUBSCR</span><br><span class="line">             <span class="number">30</span> STORE_FAST               <span class="number">6</span> (k0)</span><br><span class="line"></span><br><span class="line"> <span class="number">11</span>          <span class="number">32</span> LOAD_FAST                <span class="number">1</span> (k)</span><br><span class="line">             <span class="number">34</span> LOAD_CONST               <span class="number">2</span> (<span class="number">1</span>)</span><br><span class="line">             <span class="number">36</span> BINARY_SUBSCR</span><br><span class="line">             <span class="number">38</span> STORE_FAST               <span class="number">7</span> (k1)</span><br><span class="line"></span><br><span class="line"> <span class="number">12</span>          <span class="number">40</span> LOAD_FAST                <span class="number">1</span> (k)</span><br><span class="line">             <span class="number">42</span> LOAD_CONST               <span class="number">4</span> (<span class="number">2</span>)</span><br><span class="line">             <span class="number">44</span> BINARY_SUBSCR</span><br><span class="line">             <span class="number">46</span> STORE_FAST               <span class="number">8</span> (k2)</span><br><span class="line"></span><br><span class="line"> <span class="number">13</span>          <span class="number">48</span> LOAD_FAST                <span class="number">1</span> (k)</span><br><span class="line">             <span class="number">50</span> LOAD_CONST               <span class="number">5</span> (<span class="number">3</span>)</span><br><span class="line">             <span class="number">52</span> BINARY_SUBSCR</span><br><span class="line">             <span class="number">54</span> STORE_FAST               <span class="number">9</span> (k3)</span><br><span class="line"></span><br><span class="line"> <span class="number">14</span>          <span class="number">56</span> LOAD_GLOBAL              <span class="number">0</span> (<span class="built_in">range</span>)</span><br><span class="line">             <span class="number">58</span> LOAD_CONST               <span class="number">6</span> (<span class="number">32</span>)</span><br><span class="line">             <span class="number">60</span> CALL_FUNCTION            <span class="number">1</span></span><br><span class="line">             <span class="number">62</span> GET_ITER</span><br><span class="line">        &gt;&gt;   <span class="number">64</span> FOR_ITER               <span class="number">108</span> (to <span class="number">174</span>)</span><br><span class="line">             <span class="number">66</span> STORE_FAST              <span class="number">10</span> (i)</span><br><span class="line"></span><br><span class="line"> <span class="number">15</span>          <span class="number">68</span> LOAD_FAST                <span class="number">4</span> (x)</span><br><span class="line">             <span class="number">70</span> LOAD_FAST                <span class="number">5</span> (delta)</span><br><span class="line">             <span class="number">72</span> INPLACE_ADD</span><br><span class="line">             <span class="number">74</span> STORE_FAST               <span class="number">4</span> (x)</span><br><span class="line"></span><br><span class="line"> <span class="number">16</span>          <span class="number">76</span> LOAD_FAST                <span class="number">4</span> (x)</span><br><span class="line">             <span class="number">78</span> LOAD_CONST               <span class="number">7</span> (<span class="number">4294967295</span>)</span><br><span class="line">             <span class="number">80</span> BINARY_AND</span><br><span class="line">             <span class="number">82</span> STORE_FAST               <span class="number">4</span> (x)</span><br><span class="line"></span><br><span class="line"> <span class="number">17</span>          <span class="number">84</span> LOAD_FAST                <span class="number">2</span> (v0)</span><br><span class="line">             <span class="number">86</span> LOAD_FAST                <span class="number">3</span> (v1)</span><br><span class="line">             <span class="number">88</span> LOAD_CONST               <span class="number">8</span> (<span class="number">4</span>)</span><br><span class="line">             <span class="number">90</span> BINARY_LSHIFT</span><br><span class="line">             <span class="number">92</span> LOAD_FAST                <span class="number">6</span> (k0)</span><br><span class="line">             <span class="number">94</span> BINARY_ADD</span><br><span class="line">             <span class="number">96</span> LOAD_FAST                <span class="number">3</span> (v1)</span><br><span class="line">             <span class="number">98</span> LOAD_FAST                <span class="number">4</span> (x)</span><br><span class="line">            <span class="number">100</span> BINARY_ADD</span><br><span class="line">            <span class="number">102</span> BINARY_XOR</span><br><span class="line">            <span class="number">104</span> LOAD_FAST                <span class="number">3</span> (v1)</span><br><span class="line">            <span class="number">106</span> LOAD_CONST               <span class="number">9</span> (<span class="number">5</span>)</span><br><span class="line">            <span class="number">108</span> BINARY_RSHIFT</span><br><span class="line">            <span class="number">110</span> LOAD_FAST                <span class="number">7</span> (k1)</span><br><span class="line">            <span class="number">112</span> BINARY_ADD</span><br><span class="line">            <span class="number">114</span> BINARY_XOR</span><br><span class="line">            <span class="number">116</span> INPLACE_ADD</span><br><span class="line">            <span class="number">118</span> STORE_FAST               <span class="number">2</span> (v0)</span><br><span class="line"></span><br><span class="line"> <span class="number">18</span>         <span class="number">120</span> LOAD_FAST                <span class="number">2</span> (v0)</span><br><span class="line">            <span class="number">122</span> LOAD_CONST               <span class="number">7</span> (<span class="number">4294967295</span>)</span><br><span class="line">            <span class="number">124</span> BINARY_AND</span><br><span class="line">            <span class="number">126</span> STORE_FAST               <span class="number">2</span> (v0)</span><br><span class="line"></span><br><span class="line"> <span class="number">19</span>         <span class="number">128</span> LOAD_FAST                <span class="number">3</span> (v1)</span><br><span class="line">            <span class="number">130</span> LOAD_FAST                <span class="number">2</span> (v0)</span><br><span class="line">            <span class="number">132</span> LOAD_CONST               <span class="number">8</span> (<span class="number">4</span>)</span><br><span class="line">            <span class="number">134</span> BINARY_LSHIFT</span><br><span class="line">            <span class="number">136</span> LOAD_FAST                <span class="number">8</span> (k2)</span><br><span class="line">            <span class="number">138</span> BINARY_ADD</span><br><span class="line">            <span class="number">140</span> LOAD_FAST                <span class="number">2</span> (v0)</span><br><span class="line">            <span class="number">142</span> LOAD_FAST                <span class="number">4</span> (x)</span><br><span class="line">            <span class="number">144</span> BINARY_ADD</span><br><span class="line">            <span class="number">146</span> BINARY_XOR</span><br><span class="line">            <span class="number">148</span> LOAD_FAST                <span class="number">2</span> (v0)</span><br><span class="line">            <span class="number">150</span> LOAD_CONST               <span class="number">9</span> (<span class="number">5</span>)</span><br><span class="line">            <span class="number">152</span> BINARY_RSHIFT</span><br><span class="line">            <span class="number">154</span> LOAD_FAST                <span class="number">9</span> (k3)</span><br><span class="line">            <span class="number">156</span> BINARY_ADD</span><br><span class="line">            <span class="number">158</span> BINARY_XOR</span><br><span class="line">            <span class="number">160</span> INPLACE_ADD</span><br><span class="line">            <span class="number">162</span> STORE_FAST               <span class="number">3</span> (v1)</span><br><span class="line"></span><br><span class="line"> <span class="number">20</span>         <span class="number">164</span> LOAD_FAST                <span class="number">3</span> (v1)</span><br><span class="line">            <span class="number">166</span> LOAD_CONST               <span class="number">7</span> (<span class="number">4294967295</span>)</span><br><span class="line">            <span class="number">168</span> BINARY_AND</span><br><span class="line">            <span class="number">170</span> STORE_FAST               <span class="number">3</span> (v1)</span><br><span class="line">            <span class="number">172</span> JUMP_ABSOLUTE           <span class="number">64</span></span><br><span class="line"></span><br><span class="line"> <span class="number">21</span>     &gt;&gt;  <span class="number">174</span> LOAD_FAST                <span class="number">2</span> (v0)</span><br><span class="line">            <span class="number">176</span> LOAD_FAST                <span class="number">0</span> (v)</span><br><span class="line">            <span class="number">178</span> LOAD_CONST               <span class="number">1</span> (<span class="number">0</span>)</span><br><span class="line">            <span class="number">180</span> STORE_SUBSCR</span><br><span class="line"></span><br><span class="line"> <span class="number">22</span>         <span class="number">182</span> LOAD_FAST                <span class="number">3</span> (v1)</span><br><span class="line">            <span class="number">184</span> LOAD_FAST                <span class="number">0</span> (v)</span><br><span class="line">            <span class="number">186</span> LOAD_CONST               <span class="number">2</span> (<span class="number">1</span>)</span><br><span class="line">            <span class="number">188</span> STORE_SUBSCR</span><br><span class="line"></span><br><span class="line"> <span class="number">23</span>         <span class="number">190</span> LOAD_FAST                <span class="number">0</span> (v)</span><br><span class="line">            <span class="number">192</span> RETURN_VALUE</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">v, k</span>):</span></span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    delta = <span class="number">0x666666</span></span><br><span class="line">    k0 = k[<span class="number">0</span>]</span><br><span class="line">    k1 = k[<span class="number">1</span>]</span><br><span class="line">    k2 = k[<span class="number">2</span>]</span><br><span class="line">    k3 = k[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        delta = (delta + x) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        x = delta  &amp; <span class="number">0xffffffff</span></span><br><span class="line">        v0 = v0 + ( ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + x) ^ ( (v1&gt;&gt;<span class="number">5</span>) + k1))</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xffffffff</span></span><br><span class="line">        v1 = v1 + ( ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + x) ^ ( (v0&gt;&gt;<span class="number">5</span>) + k3))</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xffffffff</span></span><br><span class="line">    v[<span class="number">0</span>]=v0</span><br><span class="line">    v[<span class="number">1</span>]=v1</span><br><span class="line">    <span class="built_in">print</span>(v0, v1)</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">key =  [<span class="number">305419896</span>, <span class="number">2271560481</span>, <span class="number">2427178479</span>, <span class="number">4275878409</span>]</span><br><span class="line">arr = [[<span class="number">3888592564</span>, <span class="number">3737879155</span>], [<span class="number">4063334467</span>, <span class="number">2214487552</span>], [<span class="number">2420456096</span>, <span class="number">1529806583</span>], [<span class="number">2576007368</span>, <span class="number">2328179940</span>], [<span class="number">1665686107</span>, <span class="number">1748819876</span>]]</span><br><span class="line">flag = <span class="built_in">input</span>(<span class="string">&#x27;please input your secret key: &#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag))</span><br><span class="line">encry = []</span><br><span class="line">encryted = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag), <span class="number">8</span>):</span><br><span class="line">    encry.append(struct.unpack(<span class="string">&#x27;&lt;I&#x27;</span>, flag[i:   i+<span class="number">4</span>].encode(<span class="string">&#x27;utf-8&#x27;</span>))[<span class="number">0</span>])</span><br><span class="line">    encry.append(struct.unpack(<span class="string">&#x27;&lt;I&#x27;</span>, flag[i+<span class="number">4</span>: i+<span class="number">8</span>].encode(<span class="string">&#x27;utf-8&#x27;</span>))[<span class="number">0</span>])</span><br><span class="line">    encrypted = encrypt(encry, key)</span><br><span class="line">    encryted.append(encrypted)</span><br><span class="line">    encry = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(encryted != arr):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sry&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ok, fine&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>():</span></span><br><span class="line">    <span class="keyword">for</span> arri <span class="keyword">in</span> arr:</span><br><span class="line">        v0 = arri[<span class="number">0</span>]</span><br><span class="line">        v1 = arri[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            v1 = (v1 - ( ((v0&lt;&lt;<span class="number">4</span>) + k[<span class="number">2</span>]) ^ (v0 + xx[i]) ^ ( (v0&gt;&gt;<span class="number">5</span>) + k[<span class="number">3</span>]))) &amp; <span class="number">0xffffffff</span></span><br><span class="line">            v0 = (v0 - ( ((v1&lt;&lt;<span class="number">4</span>) + k[<span class="number">0</span>]) ^ (v1 + xx[i]) ^ ( (v1&gt;&gt;<span class="number">5</span>) + k[<span class="number">1</span>]))) &amp; <span class="number">0xffffffff</span></span><br><span class="line">            v1 = v1 &amp; <span class="number">0xffffffff</span></span><br><span class="line">            v0 = v0 &amp; <span class="number">0xffffffff</span></span><br><span class="line">        <span class="comment"># print(v0, v1)</span></span><br><span class="line">        <span class="built_in">print</span>(struct.pack(<span class="string">&quot;&lt;I&quot;</span>, v0).decode(<span class="string">&#x27;utf-8&#x27;</span>), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(struct.pack(<span class="string">&quot;&lt;I&quot;</span>, v1).decode(<span class="string">&#x27;utf-8&#x27;</span>), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">xx = []</span><br><span class="line">x_ = <span class="number">0</span></span><br><span class="line">delta = <span class="number">0x666666</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    x_ = (x_ + delta) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    xx.append(x_)</span><br><span class="line"></span><br><span class="line">k = key</span><br><span class="line">decrypt()</span><br></pre></td></tr></table></figure>

<h1 id="hello-apk"><a href="#hello-apk" class="headerlink" title="hello.apk"></a>hello.apk</h1><blockquote>
<p>“东华杯” 2021年大学生网络安全邀请赛暨第七届上海市大学生网络安全大赛</p>
</blockquote>
<p>本题为常见的<code>encode(flag, key)=cipher</code>的校验模式。<br>Java层可以得到信息：flag长度为42，key是程序的签名，校验函数是<code>StringFromJNI</code>，在native层。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View arg7)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(MainActivity.<span class="keyword">this</span>.input.getText().length() == <span class="number">42</span>) &#123;</span><br><span class="line">            Toast v7_2 = Toast.makeText(</span><br><span class="line">                				MainActivity.<span class="keyword">this</span>, </span><br><span class="line">                                  MainActivity.<span class="keyword">this</span>.stringFromJNI(</span><br><span class="line">                                      MainActivity.<span class="keyword">this</span>.input.getText().toString(), </span><br><span class="line">                                      <span class="keyword">new</span> hi().getSignatures(arg7)),</span><br><span class="line">                  				<span class="number">1</span>);</span><br><span class="line">            v7_2.setGravity(<span class="number">0</span>, <span class="number">0</span>, -<span class="number">700</span>);</span><br><span class="line">            v7_2.show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Toast v7_3 = Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;Hello!&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        v7_3.setGravity(<span class="number">0</span>, <span class="number">0</span>, -<span class="number">700</span>);</span><br><span class="line">        v7_3.show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(PackageManager.NameNotFoundException v7_1) &#123;  v7_1.printStackTrace();   &#125;</span><br><span class="line">    <span class="keyword">catch</span>(NoSuchAlgorithmException v7) &#123;      v7.printStackTrace();    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hi</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Log Log;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSignatures</span><span class="params">(View arg3)</span> <span class="keyword">throws</span> PackageManager.NameNotFoundException, NoSuchAlgorithmException </span>&#123;</span><br><span class="line">        MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">        Signature[] signs = arg3.getContext().getPackageManager().getPackageInfo(<span class="string">&quot;com.example.hello&quot;</span>, <span class="number">0x40</span>).signatures;</span><br><span class="line">        <span class="keyword">if</span>(signs.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            Signature sign = signs[<span class="number">0</span>]; <span class="comment">// 一个程序可能拥有多个签名</span></span><br><span class="line">            Log.i(<span class="string">&quot;hello&quot;</span>, sign.toCharsString());</span><br><span class="line">            <span class="keyword">return</span> sign.toCharsString();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;this_is_your_gift!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在native层，主要对flag进行了两次处理，最后与目标数组进行比较。<br>因为这里使用的是arm64，所以稍微有些陌生，需要阅读汇编代码。</p>
<p>先是对flag进行抑或加密，从下标1开始。抑或密钥来自签名sign，从sign的354下标开始，每次向后移动27。<br>然后对flag进行循环位移操作，这里使用了一些向量操作函数，但简单来说就是对flag的每个byte向右循环移动3位。<br>然后把flag与cipher进行比较，cipher的具体值可从ida中导出。<br>此外，sign的值可以通过安装运行从Log中获取。也可以使用JEB等工具导出<code>certificate</code>文件，二进制数据即为signatures。<br>虽然apk中<code>android:testOnly=true</code>，但是可以通过<code>adb -t install xxx.apk</code>安装。（感谢@Guohong的提示）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">jstring __fastcall <span class="title">Java_com_example_hello_MainActivity_stringFromJNI</span><span class="params">(JNIEnv *env, __int64 thiz, __int64 input, __int64 sign)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int8x16_t</span> *inputs; <span class="comment">// x20</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *signs; <span class="comment">// x0</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *signs1; <span class="comment">// x21</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 ind; <span class="comment">// x23</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> ind_p27; <span class="comment">// w24</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v11; <span class="comment">// w1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v12; <span class="comment">// w9</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v13; <span class="comment">// w11</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v14; <span class="comment">// w12</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v15; <span class="comment">// w13</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v16; <span class="comment">// w14</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v17; <span class="comment">// w15</span></span><br><span class="line">  <span class="keyword">int8x16_t</span> v18; <span class="comment">// q0</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v19; <span class="comment">// w16</span></span><br><span class="line">  <span class="keyword">int8x16_t</span> v20; <span class="comment">// q1</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v21; <span class="comment">// w17</span></span><br><span class="line">  __int64 ind2; <span class="comment">// x8</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *retStr1; <span class="comment">// x21</span></span><br><span class="line">  jstring v24; <span class="comment">// x19</span></span><br><span class="line">  <span class="keyword">char</span> retStr[<span class="number">16</span>]; <span class="comment">// [xsp+0h] [xbp-50h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> *v27; <span class="comment">// [xsp+10h] [xbp-40h]</span></span><br><span class="line">  __int64 v28; <span class="comment">// [xsp+18h] [xbp-38h]</span></span><br><span class="line"></span><br><span class="line">  v28 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  inputs = (<span class="keyword">int8x16_t</span> *)(*env)-&gt;GetStringUTFChars(env, input, <span class="number">0LL</span>);</span><br><span class="line">  <span class="comment">// input本为42个byte的数组，在这里被保存为一个3x(16 byte)的对象，后续通过input[0],input[1],input[2]引用。</span></span><br><span class="line">  <span class="comment">// input[2]只有10个byte。</span></span><br><span class="line">  signs = (*env)-&gt;GetStringUTFChars(env, sign, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( inputs-&gt;n128_u8[<span class="number">0</span>] ) <span class="comment">// 汇编：LDRB W8, [X20]，即input[0],后续相同</span></span><br><span class="line">  &#123;</span><br><span class="line">    signs1 = signs;</span><br><span class="line">    inputs-&gt;n128_u8[<span class="number">0</span>] ^= signs[<span class="number">327</span>];</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)inputs) &gt;= <span class="number">2uLL</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ind = <span class="number">1LL</span>;</span><br><span class="line">      ind_p27 = <span class="number">354</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123; <span class="comment">// input[ind] = input[ind] ^ (sign[ind_p27] + ind)</span></span><br><span class="line">        inputs-&gt;n128_u8[ind] ^= signs1[ind_p27] + (_BYTE)ind;<span class="comment">// sign的长度比较迷惑，通过Log获取</span></span><br><span class="line">        ++ind;</span><br><span class="line">        ind_p27 += <span class="number">27</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)inputs) &gt; ind );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// inputs的长度是int8x16 bit，即16char。输入42，刚好最后10单独处理</span></span><br><span class="line">  <span class="comment">// 简单来说，就是每个byte交换高3位和低5位的位置，或者说向右循环移动3位</span></span><br><span class="line">  v11 = (inputs[<span class="number">2</span>].n128_u8[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0xFFFFE01F</span> | (<span class="number">32</span> * inputs[<span class="number">2</span>].n128_u8[<span class="number">0</span>]);</span><br><span class="line">  v12 = (inputs[<span class="number">2</span>].n128_u8[<span class="number">1</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0x1F</span> | (<span class="number">32</span> * inputs[<span class="number">2</span>].n128_u8[<span class="number">1</span>]);</span><br><span class="line">  v13 = (inputs[<span class="number">2</span>].n128_u8[<span class="number">3</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0xFFFFE01F</span> | (<span class="number">32</span> * inputs[<span class="number">2</span>].n128_u8[<span class="number">3</span>]);</span><br><span class="line">  v14 = (inputs[<span class="number">2</span>].n128_u8[<span class="number">4</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0xFFFFE01F</span> | (<span class="number">32</span> * inputs[<span class="number">2</span>].n128_u8[<span class="number">4</span>]);</span><br><span class="line">  v15 = (inputs[<span class="number">2</span>].n128_u8[<span class="number">5</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0xFFFFE01F</span> | (<span class="number">32</span> * inputs[<span class="number">2</span>].n128_u8[<span class="number">5</span>]);</span><br><span class="line">  v16 = (inputs[<span class="number">2</span>].n128_u8[<span class="number">6</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0xFFFFE01F</span> | (<span class="number">32</span> * inputs[<span class="number">2</span>].n128_u8[<span class="number">6</span>]);</span><br><span class="line">  v17 = (inputs[<span class="number">2</span>].n128_u8[<span class="number">7</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0xFFFFE01F</span> | (<span class="number">32</span> * inputs[<span class="number">2</span>].n128_u8[<span class="number">7</span>]);</span><br><span class="line">  v18 = vorrq_s8(vshrq_n_u8(*inputs, <span class="number">3uLL</span>), vshlq_n_s8(*inputs, <span class="number">5uLL</span>));</span><br><span class="line">  v19 = (inputs[<span class="number">2</span>].n128_u8[<span class="number">8</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0xFFFFE01F</span> | (<span class="number">32</span> * inputs[<span class="number">2</span>].n128_u8[<span class="number">8</span>]);</span><br><span class="line">  v20 = vorrq_s8(vshrq_n_u8(inputs[<span class="number">1</span>], <span class="number">3uLL</span>), vshlq_n_s8(inputs[<span class="number">1</span>], <span class="number">5uLL</span>));</span><br><span class="line">  v21 = (inputs[<span class="number">2</span>].n128_u8[<span class="number">9</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0xFFFFE01F</span> | (<span class="number">32</span> * inputs[<span class="number">2</span>].n128_u8[<span class="number">9</span>]);</span><br><span class="line">  inputs[<span class="number">2</span>].n128_u8[<span class="number">2</span>] = (inputs[<span class="number">2</span>].n128_u8[<span class="number">2</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0x1F</span> | (<span class="number">32</span> * inputs[<span class="number">2</span>].n128_u8[<span class="number">2</span>]);</span><br><span class="line">  inputs[<span class="number">2</span>].n128_u8[<span class="number">0</span>] = v11;</span><br><span class="line">  inputs[<span class="number">2</span>].n128_u8[<span class="number">1</span>] = v12;</span><br><span class="line">  inputs[<span class="number">2</span>].n128_u8[<span class="number">3</span>] = v13;</span><br><span class="line">  inputs[<span class="number">2</span>].n128_u8[<span class="number">4</span>] = v14;</span><br><span class="line">  inputs[<span class="number">2</span>].n128_u8[<span class="number">5</span>] = v15;</span><br><span class="line">  inputs[<span class="number">2</span>].n128_u8[<span class="number">6</span>] = v16;</span><br><span class="line">  inputs[<span class="number">2</span>].n128_u8[<span class="number">7</span>] = v17;</span><br><span class="line">  inputs[<span class="number">2</span>].n128_u8[<span class="number">8</span>] = v19;</span><br><span class="line">  inputs[<span class="number">2</span>].n128_u8[<span class="number">9</span>] = v21;</span><br><span class="line">  *inputs = v18;</span><br><span class="line">  inputs[<span class="number">1</span>] = v20;</span><br><span class="line">  retStr[<span class="number">0</span>] = <span class="number">26</span>;</span><br><span class="line">  ind2 = <span class="number">0LL</span>;</span><br><span class="line">  v27 = <span class="number">0LL</span>;</span><br><span class="line">  retStr1 = &amp;retStr[<span class="number">1</span>];</span><br><span class="line">  <span class="built_in">strcpy</span>(&amp;retStr[<span class="number">1</span>], <span class="string">&quot;Wrong, wrong!&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( inputs-&gt;n128_u8[ind2] == cipher[ind2] )<span class="comment">//比较</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)++ind2 &gt; <span class="number">41</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">string</span>::assign((<span class="keyword">int</span>)retStr, <span class="string">&quot;Hello, hello!&quot;</span>, <span class="number">0xD</span>u);</span><br><span class="line">      <span class="keyword">if</span> ( (retStr[<span class="number">0</span>] &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">        retStr1 = v27;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v24 = (*env)-&gt;NewStringUTF(env, retStr1);</span><br><span class="line">  <span class="keyword">if</span> ( (retStr[<span class="number">0</span>] &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(v27)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> v24;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sign = <span class="string">&quot;308202e4308201cc020101300d06092a864886f70d010105050030373116301406035504030c0d416e64726f69642044656275673110300e060355040a0c07416e64726f6964310b30090603550406130255533020170d3231303330363134333034385a180f32303531303232373134333034385a30373116301406035504030c0d416e64726f69642044656275673110300e060355040a0c07416e64726f6964310b300906035504061302555330820122300d06092a864886f70d01010105000382010f003082010a0282010100cbf2b09e4308ebb459e8841e5a7b920497fef2b349e80648f7eb35f48d40a75e7ce7945b8b42d197bec0bf177e6c9899ed707dcc4a726cb14c1a69b0c4a02474806fa73cfb10e10f7b1665021c24762b6edad65ca63cea3c72e0d4e4ca3f98301173eec3254337af1f5a11f779ecbe04d1b74d53f5835e011222155a56f97e00d75374cd93080dfa087cd356a99fe1eebf5d6d5e31846aad5252c3a17a4656e2e210ce1c7aa4d147fb8cf440a50add61bbb2ec299a2e0dab0b4504796ac3a899da553ab1d83576691ab23409d18398014b3b5eaf12e83f4d99aa09e1e4e4cae133530730c1133da2b3dee37b58eb1a5795b221ec5a8830731a41167d295f9e1b0203010001300d06092a864886f70d010105050003820101000e4740235e9cf2be33de3e06d777139cbbc5cf0622285c17da04697b8067318aaf8df0fbb4d3166f293ea15aa2592f06eb6929af063722ac9f30ad85e2c087564931d6ac65fcd5fbc864b3dc9841e039c6e1d5fbc5c2f8adf90a547bc4ebc07d387914db24451c2cc89925359bd3bb0750c7aabf9d743b1893e98bbc8ff74b24fc0b4be2dbaaf1c917bba01496d0617ffc3a4a8b7a6e79a3036298a6ebf57bb00001e43a0b242864eebb0fcec9e323144d4447c878430f18e6e358ad97566fa04d1f07b171c1476c9af5a1eba0bf6616e219c0b9e1299d09fecded24a880397f92e0f99d8951228c7770c184fd77adff943bfc8b6aa524c5f0a6d7686fe35486&quot;</span></span><br><span class="line">cipher = [<span class="number">0xca</span>, <span class="number">0xeb</span>, <span class="number">0x4a</span>, <span class="number">0x8a</span>, <span class="number">0x68</span>, <span class="number">0xe1</span>, <span class="number">0xa1</span>, <span class="number">0xeb</span>, <span class="number">0xe1</span>, <span class="number">0xee</span>, <span class="number">0x6b</span>, <span class="number">0x84</span>, <span class="number">0xa2</span>, <span class="number">0x6d</span>, <span class="number">0x49</span>, <span class="number">0xc8</span>, <span class="number">0x8e</span>, <span class="number">0xe</span>, <span class="number">0xcc</span>, <span class="number">0xe9</span>, <span class="number">0x45</span>, <span class="number">0xcf</span>, <span class="number">0x23</span>, <span class="number">0xcc</span>, <span class="number">0xc5</span>, <span class="number">0x4c</span>, <span class="number">0xc</span>, <span class="number">0x85</span>, <span class="number">0xcf</span>, <span class="number">0xa9</span>, <span class="number">0x8c</span>, <span class="number">0xf6</span>, <span class="number">0xe6</span>, <span class="number">0xd6</span>, <span class="number">0x26</span>, <span class="number">0x6d</span>, <span class="number">0xac</span>, <span class="number">0xc</span>, <span class="number">0xac</span>, <span class="number">0x77</span>, <span class="number">0xe0</span>, <span class="number">0x64</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># shift byte</span></span><br><span class="line"><span class="keyword">for</span> ind <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">    x = ((cipher[ind] &gt;&gt; <span class="number">5</span>) &amp; <span class="number">0x7f</span>) | ((cipher[ind] &lt;&lt; <span class="number">3</span>) &amp; <span class="number">0x7f</span>)</span><br><span class="line">    cipher[ind] = x</span><br><span class="line"></span><br><span class="line">ind = <span class="number">354</span></span><br><span class="line"><span class="keyword">for</span> ind1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">42</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>( (cipher[ind1] ^ (<span class="built_in">ord</span>(sign[ind]) + ind1 )) &amp; <span class="number">0x7f</span> ), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    ind = ind + <span class="number">27</span></span><br></pre></td></tr></table></figure>




    </div>

    
    
    
        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/CTF/" rel="tag"># CTF</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/22/Web-Labs/" rel="prev" title="SQL,XSS,文件上传实验记录">
      <i class="fa fa-chevron-left"></i> SQL,XSS,文件上传实验记录
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/12/10/Fuzz-Basic/" rel="next" title="Fuzz入门">
      Fuzz入门 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          見出し
        </li>
        <li class="sidebar-nav-overview">
          概要
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Accelerate-Time"><span class="nav-number">1.</span> <span class="nav-text">Accelerate-Time</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Time-Machine"><span class="nav-number">2.</span> <span class="nav-text">Time-Machine</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mimic-xctf-hahahaha"><span class="nav-number">3.</span> <span class="nav-text">mimic-xctf-hahahaha</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mimic-xctf-studydesk"><span class="nav-number">4.</span> <span class="nav-text">mimic-xctf-studydesk</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%96%E7%93%9C"><span class="nav-number">5.</span> <span class="nav-text">卖瓜</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#bytecode"><span class="nav-number">6.</span> <span class="nav-text">bytecode</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#hello-apk"><span class="nav-number">7.</span> <span class="nav-text">hello.apk</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="slient2009"
      src="/images/round_tiger.png">
  <p class="site-author-name" itemprop="name">slient2009</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">ポスト</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">タグ</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://slient2009.github.io/atom.xml" title="RSS → https:&#x2F;&#x2F;slient2009.github.io&#x2F;atom.xml"><i class="rss fa-fw"></i>RSS</a>
      </span>
  </div>






      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">slient2009</span>
</div>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="合計閲覧者数">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="閲覧合計数">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
